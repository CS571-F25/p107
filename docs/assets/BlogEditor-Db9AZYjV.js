import{j as e,b as U,R as G,c as P,B as Z,a as h,A as N,C as j,F as a,M as o,d as ee}from"./vendor-bootstrap-C6xIMti8.js";import{c as se,u as te,r as l}from"./vendor-router-DArSVHJ3.js";import{w as ae,P as g,T as le,c as ie,d as re,e as T,f as m,h as q,i as ne,p as oe}from"./blog-B2gm80zW.js";import{L as ce}from"./auth-Sw-QPVcd.js";import"./vendor-react-Bzgz95E1.js";import"./vendor-firebase-CYcY3q11.js";function de(){const{id:c}=se(),C=te(),u=!!c,[s,v]=l.useState({title:"",subtitle:"",content:"",excerpt:"",category:"",tags:"",coverImage:"",slug:"",status:g.DRAFT}),[$,L]=l.useState(!1),[D,I]=l.useState(!1),[f,b]=l.useState(!1),[B,x]=l.useState(""),[E,r]=l.useState(""),[W,F]=l.useState(!1),[z,y]=l.useState(!1),[k,p]=l.useState(""),[A,H]=l.useState(null),{theme:O}=l.useContext(le),{user:ue}=l.useContext(ce),S=O==="dark",{permissions:R}=ie(s.authorId);l.useEffect(()=>{u&&_()},[c]),l.useEffect(()=>{if(u&&s.title){const t=setInterval(()=>{J()},3e4);return()=>clearInterval(t)}},[s,u]);const _=async()=>{try{L(!0);const t=await re(c);v({title:t.title||"",subtitle:t.subtitle||"",content:t.content||"",excerpt:t.excerpt||"",category:t.category||"",tags:t.tags?t.tags.join(", "):"",coverImage:t.coverImage||"",slug:t.slug||"",status:t.status||g.DRAFT,authorId:t.authorId})}catch(t){r(t.message||"Failed to load post")}finally{L(!1)}},J=async()=>{if(!(!u||!s.title.trim()))try{p("Saving..."),await T(c,{...s,tags:s.tags.split(",").map(t=>t.trim()).filter(t=>t),slug:s.slug||m(s.title)}),p("Saved"),H(new Date),setTimeout(()=>p(""),2e3)}catch{p("Save failed"),setTimeout(()=>p(""),3e3)}},d=t=>{const{name:i,value:n}=t.target;v(w=>({...w,[i]:n})),i==="title"&&!s.slug&&v(w=>({...w,slug:m(n)}))},K=async()=>{try{if(I(!0),x(""),r(""),!s.title.trim()){r("Title is required");return}const t={...s,tags:s.tags.split(",").map(i=>i.trim()).filter(i=>i),slug:s.slug||m(s.title),status:g.DRAFT,readTime:Math.ceil(s.content.split(" ").length/200)};if(u)await T(c,t),x("Draft updated successfully!");else{const i=await q(t);x("Draft saved successfully!"),C(`/editor/${i}`,{replace:!0})}H(new Date)}catch(t){r(t.message||"Failed to save draft")}finally{I(!1)}},Q=async()=>{try{if(b(!0),r(""),!s.title.trim()||!s.content.trim()){r("Title and content are required for publishing");return}if(!s.excerpt.trim()){r("Excerpt is required for publishing");return}let t=c;if(u){const i={...s,tags:s.tags.split(",").map(n=>n.trim()).filter(n=>n),slug:s.slug||m(s.title),readTime:Math.ceil(s.content.split(" ").length/200)};await T(c,i)}else{const i={...s,tags:s.tags.split(",").map(n=>n.trim()).filter(n=>n),slug:s.slug||m(s.title),status:g.DRAFT,readTime:Math.ceil(s.content.split(" ").length/200)};t=await q(i)}await oe(t),x("Post published successfully!"),y(!1),setTimeout(()=>{C(`/blog/${s.slug||m(s.title)}`)},1e3)}catch(t){r(t.message||"Failed to publish post")}finally{b(!1)}},V=async()=>{try{b(!0),await ne(c),x("Post unpublished successfully!"),v(t=>({...t,status:g.DRAFT}))}catch(t){r(t.message||"Failed to unpublish post")}finally{b(!1)}},X=()=>e.jsxs("div",{children:[e.jsx("h1",{children:s.title}),s.subtitle&&e.jsx("h2",{className:"text-muted",children:s.subtitle}),s.coverImage&&e.jsx("img",{src:s.coverImage,alt:"Cover",className:"img-fluid mb-3",style:{maxHeight:"300px",objectFit:"cover"}}),e.jsx("div",{style:{whiteSpace:"pre-wrap"},children:s.content})]});if($)return e.jsx(U,{className:"py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading editor..."})]})});const Y={backgroundColor:S?"#1a1a1a":"#fff",minHeight:"100vh"},M={backgroundColor:S?"#2d3748":"#fff",borderColor:S?"#4a5568":"#dee2e6"};return e.jsx("div",{style:Y,children:e.jsxs(U,{fluid:!0,style:{maxWidth:"1200px",padding:"2rem 1rem"},children:[e.jsx(G,{className:"mb-4",children:e.jsx(P,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1",children:u?"Edit Post":"Create New Post"}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[s.status&&e.jsx(Z,{bg:s.status===g.PUBLISHED?"success":"secondary",children:s.status}),k&&e.jsx("small",{className:"text-muted",children:k}),A&&e.jsxs("small",{className:"text-muted",children:["Last saved: ",A.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{variant:"outline-secondary",onClick:()=>C("/"),children:"Cancel"}),e.jsx(h,{variant:"outline-info",onClick:()=>F(!0),disabled:!s.title||!s.content,children:"Preview"}),e.jsx(h,{variant:"secondary",onClick:K,disabled:D||!s.title,children:D?"Saving...":"Save Draft"}),s.status===g.PUBLISHED?e.jsx(h,{variant:"warning",onClick:V,disabled:f||!R.canPublish,children:f?"Unpublishing...":"Unpublish"}):e.jsx(h,{variant:"success",onClick:()=>y(!0),disabled:!s.title||!s.content||!R.canPublish,children:"Publish"})]})]})})}),B&&e.jsx(N,{variant:"success",onClose:()=>x(""),dismissible:!0,children:B}),E&&e.jsx(N,{variant:"danger",onClose:()=>r(""),dismissible:!0,children:E}),e.jsxs(G,{className:"g-4",children:[e.jsx(P,{lg:8,children:e.jsx(j,{style:M,children:e.jsx(j.Body,{children:e.jsxs(a,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Title *"}),e.jsx(a.Control,{type:"text",name:"title",value:s.title,onChange:d,placeholder:"Enter post title",required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Subtitle"}),e.jsx(a.Control,{type:"text",name:"subtitle",value:s.subtitle,onChange:d,placeholder:"Enter subtitle (optional)"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"URL Slug"}),e.jsx(a.Control,{type:"text",name:"slug",value:s.slug,onChange:d,placeholder:"url-friendly-slug"}),e.jsx(a.Text,{className:"text-muted",children:"Auto-generated from title if left empty"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Content *"}),e.jsx(a.Control,{as:"textarea",rows:15,name:"content",value:s.content,onChange:d,placeholder:"Write your post content here... (Markdown supported)",required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Excerpt"}),e.jsx(a.Control,{as:"textarea",rows:3,name:"excerpt",value:s.excerpt,onChange:d,placeholder:"Brief description for post preview"}),e.jsx(a.Text,{className:"text-muted",children:"Used in post cards and social sharing"})]})]})})})}),e.jsx(P,{lg:4,children:e.jsxs(j,{style:M,children:[e.jsx(j.Header,{children:"Post Settings"}),e.jsx(j.Body,{children:e.jsxs(a,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Category"}),e.jsxs(a.Select,{name:"category",value:s.category,onChange:d,children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"Travel",children:"Travel"}),e.jsx("option",{value:"Technology",children:"Technology"}),e.jsx("option",{value:"Life",children:"Life"}),e.jsx("option",{value:"Business",children:"Business"})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Tags"}),e.jsx(a.Control,{type:"text",name:"tags",value:s.tags,onChange:d,placeholder:"tag1, tag2, tag3"}),e.jsx(a.Text,{className:"text-muted",children:"Separate tags with commas"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Cover Image URL"}),e.jsx(a.Control,{type:"url",name:"coverImage",value:s.coverImage,onChange:d,placeholder:"https://example.com/image.jpg"}),s.coverImage&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.coverImage,alt:"Cover preview",className:"img-fluid rounded",style:{maxHeight:"150px",objectFit:"cover"},onError:t=>{t.target.style.display="none"}})})]})]})})]})})]}),e.jsxs(o,{show:W,onHide:()=>F(!1),size:"lg",children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Preview"})}),e.jsx(o.Body,{children:X()})]}),e.jsxs(o,{show:z,onHide:()=>y(!1),children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Publish Post"})}),e.jsxs(o.Body,{children:[e.jsx("p",{children:"Are you ready to publish this post?"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",s.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Slug:"})," ",s.slug||m(s.title)]}),!s.excerpt&&e.jsx(N,{variant:"warning",children:"Consider adding an excerpt for better social sharing."})]}),e.jsxs(o.Footer,{children:[e.jsx(h,{variant:"secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx(h,{variant:"success",onClick:Q,disabled:f,children:f?"Publishing...":"Publish Now"})]})]}),e.jsx(ee,{position:"bottom-end",className:"p-3"})]})})}const ve=ae(de,"blog:write-own");export{ve as default};
