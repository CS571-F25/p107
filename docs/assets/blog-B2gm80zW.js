import{j as t,C as Y,B as ue,a as U,T as J,S as G,A as he,b as de,R as Ee,c as fe,M as Z,d as Ae}from"./vendor-bootstrap-C6xIMti8.js";import{r as h,L as Ce,c as Le,u as Ne}from"./vendor-router-DArSVHJ3.js";import{R as B,a as P,L as ee,g as we,c as Ue,b as Te,i as Ie,h as w,d as k,l as $}from"./auth-Sw-QPVcd.js";import{o as He,q as D,c as R,w as H,b as te,e as M,f as O,d as be,s as Be,h as z,p as K,r as De}from"./vendor-firebase-CYcY3q11.js";const se=h.createContext();function Xe({children:o}){const[e,s]=h.useState(localStorage.getItem("theme")||"light");h.useEffect(()=>{localStorage.setItem("theme",e),document.documentElement.setAttribute("data-bs-theme",e)},[e]);const r=()=>{const n=e==="dark"?"light":"dark";s(n),localStorage.setItem("theme",n)},i=h.useMemo(()=>({theme:e,toggleTheme:r}),[e]);return t.jsx(se.Provider,{value:i,children:o})}const ye=()=>P.currentUser?.uid||null,xe=o=>{const[e,s]=h.useState(!1),[r,i]=h.useState(!0),{isLoggedIn:n}=h.useContext(ee);return h.useEffect(()=>{(async()=>{try{i(!0);const c=ye(),j=await w(c,o);s(j)}catch(c){console.error("Error checking permission:",c),s(!1)}finally{i(!1)}})()},[o,n]),{hasAccess:e,loading:r}},Qe=o=>{const[e,s]=h.useState({canRead:!0,canEdit:!1,canDelete:!1,canPublish:!1}),[r,i]=h.useState(!0),{isLoggedIn:n}=h.useContext(ee);return h.useEffect(()=>{(async()=>{try{i(!0);const c=ye();if(!c){s({canRead:!0,canEdit:!1,canDelete:!1,canPublish:!1});return}const[j,g,x]=await Promise.all([w(c,"blog:write-all"),w(c,"blog:publish-all"),w(c,"blog:delete-all")]),y=c===o,d=await w(c,"blog:write-own"),m=await w(c,"blog:publish-own"),L=await w(c,"blog:delete-own");s({canRead:!0,canEdit:j||y&&d,canDelete:x||y&&L,canPublish:g||y&&m})}catch(c){console.error("Error checking post permissions:",c),s({canRead:!0,canEdit:!1,canDelete:!1,canPublish:!1})}finally{i(!1)}})()},[o,n]),{permissions:e,loading:r}},ke=()=>{const[o,e]=h.useState({level:B.GUEST,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!0}),[s,r]=h.useState(0);h.useEffect(()=>{let a=!0;const c=async g=>{try{if(console.log("ðŸ”„ useUserPermissions: Checking permissions for user:",g,"refreshKey:",s),!a)return;if(!g){console.log("ðŸ”„ useUserPermissions: No user ID, setting guest permissions"),a&&e({level:B.GUEST,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!1});return}a&&e(N=>({...N,loading:!0})),console.log("ðŸ”„ useUserPermissions: Fetching all permissions...");const[x,y,d,m]=await Promise.all([we(g),Ue(g),Te(g),Ie(g)]);console.log("ðŸ”„ useUserPermissions: Got results:",{level:x,adminAccess:y,contentAccess:d,ownerStatus:m});const L={level:x,canAccessAdmin:y,canManageAll:d,isOwner:m,loading:!1};console.log("ðŸ”„ useUserPermissions: Setting new permissions:",L),a&&e(L)}catch(x){console.error("âŒ useUserPermissions: Error checking permissions:",x),a&&e({level:B.UNVERIFIED_USER,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!1})}};console.log("ðŸ”„ useUserPermissions: Setting up Firebase auth listener, refreshKey:",s);const j=He(P,g=>{console.log("ðŸ”„ useUserPermissions: Auth state changed:",g?`logged in as ${g.uid}`:"logged out"),g?c(g.uid):a&&e({level:B.GUEST,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!1})});return()=>{console.log("ðŸ”„ useUserPermissions: Cleaning up auth listener"),a=!1,j()}},[s]);const i=!!P.currentUser;return{...o,isLoggedIn:i,forceRefresh:()=>{console.log("ðŸ”„ useUserPermissions: Force refresh triggered"),r(a=>a+1)},isGuest:o.level===B.GUEST,isUnverifiedUser:o.level===B.UNVERIFIED_USER,isVerifiedUser:o.level===B.VERIFIED_USER,isAdmin:o.level<=B.ADMIN}};function Re(){const{theme:o}=h.useContext(se),e=[{text:"raised",description:" by West Lake in Hangzhou",linkClass:"theme-link link-blue",id:"raised"},{text:"learned to orienteer",description:" in high school",linkClass:"theme-link link-teal",id:"orienteer"},{text:"solo cycled",description:" around Taiwan and topped the highest road in SE Asia",linkClass:"theme-link link-red",id:"taiwan-ride"},{text:"bikepacked",description:" from the Midwest to the Pacific",linkClass:"theme-link link-brown",id:"backpacking"},{text:"now",description:" studying in Madison",linkClass:"theme-link link-blue",id:"madison"}],s={github:"https://github.com/eliotziqi",linkedin:"https://www.linkedin.com/in/zzhu-eliot/",twitter:"https://x.com/EliotOrientWay",email:"mailto:zhu.ziqi@foxmail.com"};return t.jsxs("div",{className:"sticky-top",style:{top:"2rem"},children:[t.jsx("div",{className:"mb-4 pb-4 title-hover-group",style:{position:"relative"},onMouseEnter:r=>{const i=r.currentTarget.querySelector(".title-tooltip");i&&(i.style.opacity="1")},onMouseLeave:r=>{const i=r.currentTarget.querySelector(".title-tooltip");i&&(i.style.opacity="0")},children:t.jsxs("div",{style:{cursor:"default"},children:[t.jsx("h1",{className:"mb-1 lh-1",style:{fontSize:"clamp(1.8rem, 6vw, 2.5rem)",fontWeight:"800",letterSpacing:"-0.03em",whiteSpace:"nowrap"},children:"OrientÂ Way"}),t.jsx("h2",{className:"mb-0 text-muted",style:{fontSize:"clamp(1rem, 3vw, 1.1rem)",fontWeight:"400",letterSpacing:"-0.015em",marginTop:"0.15rem"},children:"a blog by Eliot Zhu"}),t.jsx("small",{className:"text-muted title-tooltip",style:{fontSize:"0.7rem",lineHeight:"1.2",position:"absolute",top:"-1.2rem",left:"0",opacity:"0",transition:"opacity 0.3s ease",pointerEvents:"none",whiteSpace:"nowrap"},children:"find direction and move on"})]})}),t.jsx("div",{className:"mb-4",children:t.jsx("ul",{className:"list-unstyled mb-0",style:{fontSize:"0.95rem",lineHeight:"1.6"},children:e.map((r,i)=>t.jsxs("li",{className:"mb-1",children:[t.jsx("span",{className:"text-muted",children:"â€¢ "}),t.jsx("a",{href:`#${r.id}`,className:r.linkClass,onClick:n=>{n.preventDefault(),console.log(`Would navigate to: ${r.id}`),alert(`This would be a link to a blog post about: ${r.text}`)},children:r.text}),t.jsx("span",{className:"text-muted",children:r.description})]},i))})}),t.jsxs("div",{className:"d-flex gap-3 mb-4",children:[t.jsx("a",{href:s.github,target:"_blank",rel:"noopener noreferrer",className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:r=>r.target.style.color="#333",onMouseLeave:r=>r.target.style.color="inherit",title:"GitHub",children:t.jsx("i",{className:"bi bi-github"})}),t.jsx("a",{href:s.linkedin,target:"_blank",rel:"noopener noreferrer",className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:r=>r.target.style.color="#0077b5",onMouseLeave:r=>r.target.style.color="inherit",title:"LinkedIn",children:t.jsx("i",{className:"bi bi-linkedin"})}),t.jsx("a",{href:s.twitter,target:"_blank",rel:"noopener noreferrer",className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:r=>r.target.style.color="#1da1f2",onMouseLeave:r=>r.target.style.color="inherit",title:"Twitter/X",children:t.jsx("i",{className:"bi bi-twitter-x"})}),t.jsx("a",{href:s.email,className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:r=>r.target.style.color="#6c757d",onMouseLeave:r=>r.target.style.color="inherit",title:"Email",children:t.jsx("i",{className:"bi bi-envelope"})})]})]})}const re="likes",ze=async(o,e)=>{try{if(!e)throw new Error("User must be logged in to like posts");if(await je(o,e))return{liked:!0,total:await T(o),message:"Post already liked"};const r=`${o}_${e}`;return await Be(M(k,re,r),{postId:o,userId:e,createdAt:z()}),await $({actorId:e,action:"blog:like",entityType:"post",entityId:o,meta:{likeId:r}}),{liked:!0,total:await T(o),message:"Post liked successfully"}}catch(s){throw console.error("Error liking post:",s),s}},Me=async(o,e)=>{try{if(!e)throw new Error("User must be logged in to unlike posts");const s=`${o}_${e}`,r=M(k,re,s);return(await O(r)).exists()?(await be(r),await $({actorId:e,action:"blog:unlike",entityType:"post",entityId:o,meta:{likeId:s}}),{liked:!1,total:await T(o),message:"Post unliked successfully"}):{liked:!1,total:await T(o),message:"Post not previously liked"}}catch(s){throw console.error("Error unliking post:",s),s}},je=async(o,e)=>{try{if(!e)return null;const s=`${o}_${e}`,r=await O(M(k,re,s));return r.exists()?{id:r.id,...r.data(),createdAt:r.data().createdAt?.toDate()}:null}catch(s){return console.error("Error getting like:",s),null}},oe=async(o,e)=>!!await je(o,e),T=async o=>{try{const e=D(R(k,re),H("postId","==",o));return(await te(e)).size}catch(e){return console.error("Error getting like count:",e),0}},ve=async(o,e)=>{try{return await oe(o,e)?await Me(o,e):await ze(o,e)}catch(s){throw console.error("Error toggling like:",s),s}};function Ze({post:o,theme:e="blue"}){const{theme:s}=h.useContext(se),{isLoggedIn:r}=h.useContext(ee),i=s==="dark",[n,a]=h.useState(!1),[c,j]=h.useState(o),[g,x]=h.useState(!1),[y,d]=h.useState(""),{id:m,slug:L,title:N,subtitle:X,excerpt:q,coverImage:f,category:ie,tags:W=[],publishedAt:ne,readTime:_,author:me}=c,ae=async p=>{if(p.preventDefault(),p.stopPropagation(),console.log("ðŸ” BlogCard handleLike called, isLoggedIn:",r),!r){console.log("ðŸš« User not logged in, showing toast"),d("ðŸ˜Š è¯·å…ˆæ³¨å†Œå¹¶ç™»å½•æ‰èƒ½ç‚¹èµžæ–‡ç« ï¼åªæœ‰æ³¨å†Œç”¨æˆ·æ‰èƒ½è¡¨è¾¾å¯¹æ–‡ç« çš„å–œçˆ±ã€‚"),x(!0);return}try{a(!0);const E=await ve(c.id,P.currentUser?.uid);j(l=>({...l,userHasLiked:E.liked,likeCount:E.total})),d(E.message),x(!0)}catch(E){console.error("Error toggling like:",E),d("ç‚¹èµžæ“ä½œå¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•"),x(!0)}finally{a(!1)}},le=p=>{if(!p)return"";const E=new Date;return p.getFullYear()===E.getFullYear()?p.toLocaleDateString("en-US",{month:"long",day:"numeric"}):p.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},ce=(p=>({travel:"red",tech:"blue",life:"teal",review:"brown",startup:"brown",personal:"blue"})[p]||"blue")(ie),Q={fontSize:"0.7rem",backgroundColor:i?"rgba(255, 255, 255, 0.2)":"rgba(108, 117, 125, 0.8)",color:"#ffffff",border:i?"1px solid rgba(255, 255, 255, 0.3)":"1px solid rgba(108, 117, 125, 0.9)",fontWeight:"500",backdropFilter:i?"blur(8px)":"none"};return t.jsxs(Y,{className:`h-100 shadow-sm border-0 mb-4 card card-${ce}`,children:[f&&t.jsx("div",{style:{height:"200px",overflow:"hidden"},children:t.jsx(Y.Img,{variant:"top",src:f,alt:N,style:{width:"100%",height:"100%",objectFit:"cover",transition:"transform 0.3s ease"},onMouseEnter:p=>p.target.style.transform="scale(1.05)",onMouseLeave:p=>p.target.style.transform="scale(1)"})}),t.jsxs(Y.Body,{className:"d-flex flex-column",children:[t.jsx("div",{className:"d-flex justify-content-between align-items-start mb-2",children:t.jsx("div",{className:"card-date",children:le(ne)})}),t.jsx(Ce,{to:`/blog/${L||m}`,className:"text-decoration-none text-reset",children:t.jsx(Y.Title,{className:"mb-1 card-title",style:{fontSize:"1.2rem",lineHeight:"1.3"},children:N})}),X&&t.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.9rem",fontWeight:"500"},children:X}),t.jsx(Y.Text,{className:"text-muted flex-grow-1",style:{fontSize:"0.85rem",lineHeight:"1.5"},children:q}),t.jsxs("div",{className:"mt-auto pt-2",children:[W.length>0&&t.jsx("div",{className:"mb-2",children:t.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[W.slice(0,3).map((p,E)=>t.jsx(ue,{variant:"outline-secondary",className:"border-0",style:Q,children:p},E)),W.length>3&&t.jsxs(ue,{variant:"outline-secondary",className:"border-0",style:Q,children:["+",W.length-3]})]})}),t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsxs(U,{variant:c.userHasLiked?"primary":"outline-primary",size:"sm",onClick:ae,disabled:n,title:r?"ç‚¹èµžè¿™ç¯‡æ–‡ç« ":"è¯·å…ˆç™»å½•æ‰èƒ½ç‚¹èµž",style:{fontSize:"0.8rem",...r?{}:{opacity:.7}},children:[t.jsx("i",{className:`bi ${c.userHasLiked?"bi-heart-fill":"bi-heart"} me-1`}),n?"Loading...":`Like${c.likeCount>0?` (${c.likeCount})`:""}`]}),_&&t.jsxs("small",{className:"text-muted",children:[_," min read"]})]})]})]}),t.jsx(J,{show:g,onClose:()=>x(!1),delay:3e3,autohide:!0,style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,maxWidth:"350px"},children:t.jsx(J.Body,{children:y})})]})}function pe({permission:o,children:e,fallback:s=null,showLoading:r=!0}){const{hasAccess:i,loading:n}=xe(o);return n&&r?t.jsx(G,{animation:"border",size:"sm"}):i?e:s}function Je({children:o,fallback:e=null,showLoading:s=!0}){const{canAccessAdmin:r,loading:i}=ke();return i&&s?t.jsx(G,{animation:"border",size:"sm"}):r?o:e}function et(o,e){return function(r){const{hasAccess:i,loading:n}=xe(e);return n?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh"},children:t.jsx(G,{animation:"border",variant:"primary"})}):i?t.jsx(o,{...r}):t.jsxs(he,{variant:"danger",className:"text-center",children:[t.jsx("h4",{children:"Access Denied"}),t.jsx("p",{children:"You don't have permission to access this page."})]})}}function tt(o){return function(s){const{canAccessAdmin:r,loading:i,level:n,isOwner:a}=ke();return i?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh"},children:t.jsx(G,{animation:"border",variant:"primary"})}):r?t.jsx(o,{...s}):t.jsxs(he,{variant:"danger",className:"text-center",children:[t.jsx("h4",{children:"Admin Access Required"}),t.jsx("p",{children:"You need administrator privileges to access this page."}),t.jsx("div",{className:"mt-3",children:t.jsxs("small",{className:"text-muted",children:["Debug info: Level: ",n,", Owner: ",a?"Yes":"No"]})}),t.jsx("div",{className:"mt-3",children:t.jsx("button",{className:"btn btn-warning",onClick:()=>window.location.reload(),children:"Refresh Permissions"})})]})}}const A="posts",v={DRAFT:"draft",PUBLISHED:"published",ARCHIVED:"archived"},st=async o=>{try{const e=P.currentUser?.uid;if(!e)throw new Error("User must be logged in to create posts");if(!(await w(e,"blog:write-own")||await w(e,"blog:write-all")))throw new Error("You do not have permission to create posts");const r=o.slug||$e(o.title);await Se(r);const i=await De(R(k,A),{...o,slug:r,authorId:e,status:o.status||v.DRAFT,publishedAt:o.status===v.PUBLISHED?z():null,createdAt:z(),updatedAt:z(),likes:0,views:0,isPublished:o.status===v.PUBLISHED||o.isPublished===!0});return await $({actorId:e,action:"blog:create",entityType:"post",entityId:i.id,meta:{status:o.status||v.DRAFT}}),i.id}catch(e){throw console.error("Error creating post:",e),e}},rt=async(o=10,e={})=>{try{const s=P.currentUser?.uid,{status:r="published-only",authorId:i=null,category:n=null}=e;let a;const c=s&&await w(s,"view:all-posts"),j=await we(s);r==="all"&&c?a=R(k,A):r==="drafts-only"&&c?a=D(R(k,A),H("status","==",v.DRAFT)):r==="my-drafts"&&s?a=D(R(k,A),H("authorId","==",s),H("status","==",v.DRAFT)):a=D(R(k,A),H("status","==",v.PUBLISHED)),i&&(a=D(a,H("authorId","==",i))),n&&(a=D(a,H("category","==",n)));const g=await te(a),x=[];g.forEach(d=>{const m=d.data();x.push({id:d.id,...m,publishedAt:m.publishedAt?.toDate(),createdAt:m.createdAt?.toDate(),updatedAt:m.updatedAt?.toDate()})});const y=x.filter(d=>d.status===v.PUBLISHED?!0:s?d.authorId===s?!0:c:!1).sort((d,m)=>{const L=d.publishedAt||d.createdAt||new Date(0);return(m.publishedAt||m.createdAt||new Date(0))-L}).slice(0,o);if(s)for(const d of y)try{d.likeCount=await T(d.id),d.userHasLiked=await oe(d.id,s)}catch(m){console.warn("Error fetching like info for post:",d.id,m),d.likeCount=d.likes||0,d.userHasLiked=!1}else for(const d of y)d.likeCount=await T(d.id),d.userHasLiked=!1;return y}catch(s){throw console.error("Error getting posts:",s),s}},ot=async o=>{try{const e=M(k,A,o),s=await O(e);if(!s.exists())throw new Error("Post not found");const r=s.data(),i=P.currentUser?.uid;if(!await Pe(r,i))throw new Error("You do not have permission to view this post");r.status===v.PUBLISHED&&await K(e,{views:(r.views||0)+1});const a={id:s.id,...r,publishedAt:r.publishedAt?.toDate(),createdAt:r.createdAt?.toDate(),updatedAt:r.updatedAt?.toDate(),views:(r.views||0)+(r.status===v.PUBLISHED?1:0)};return i?(a.likeCount=await T(o),a.userHasLiked=await oe(o,i)):(a.likeCount=await T(o),a.userHasLiked=!1),a}catch(e){throw console.error("Error getting post:",e),e}},it=async(o,e)=>{try{const s=P.currentUser?.uid;if(!s)throw new Error("User must be logged in to update posts");const r=M(k,A,o),i=await O(r);if(!i.exists())throw new Error("Post not found");const n=i.data();if(!await qe(n,s))throw new Error("You do not have permission to edit this post");e.slug&&e.slug!==n.slug&&await Se(e.slug,o),await K(r,{...e,updatedAt:z()}),await $({actorId:s,action:"blog:update",entityType:"post",entityId:o,meta:{fields:Object.keys(e)}})}catch(s){throw console.error("Error updating post:",s),s}},nt=async o=>{try{const e=P.currentUser?.uid;if(!e)throw new Error("User must be logged in to publish posts");const s=M(k,A,o),r=await O(s);if(!r.exists())throw new Error("Post not found");const i=r.data();if(!await We(i,e))throw new Error("You do not have permission to publish this post");if(!i.title||!i.content)throw new Error("Post must have title and content to be published");return await K(s,{status:v.PUBLISHED,isPublished:!0,publishedAt:z(),updatedAt:z()}),await $({actorId:e,action:"blog:publish",entityType:"post",entityId:o}),!0}catch(e){throw console.error("Error publishing post:",e),e}},at=async o=>{try{const e=P.currentUser?.uid;if(!e)throw new Error("User must be logged in to unpublish posts");const s=M(k,A,o),r=await O(s);if(!r.exists())throw new Error("Post not found");const i=r.data();if(!(await w(e,"blog:publish-all")||i.authorId===e&&await w(e,"blog:publish-own")))throw new Error("You do not have permission to unpublish this post");return await K(s,{status:v.DRAFT,isPublished:!1,updatedAt:z()}),await $({actorId:e,action:"blog:unpublish",entityType:"post",entityId:o}),!0}catch(e){throw console.error("Error unpublishing post:",e),e}},lt=async o=>{try{const e=P.currentUser?.uid;if(!e)throw new Error("User must be logged in to delete posts");const s=M(k,A,o),r=await O(s);if(!r.exists())throw new Error("Post not found");const i=r.data();if(!await _e(i,e))throw new Error("You do not have permission to delete this post");return await be(s),await $({actorId:e,action:"blog:delete",entityType:"post",entityId:o,meta:{title:i.title}}),!0}catch(e){throw console.error("Error deleting post:",e),e}},$e=o=>o.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),Se=async(o,e=null)=>{try{const s=D(R(k,A),H("slug","==",o)),r=await te(s);let i=!0;if(r.forEach(n=>{e&&n.id===e||(i=!1)}),!i)throw new Error(`Slug "${o}" is already in use. Please choose a different one.`);return!0}catch(s){throw console.error("Error validating slug:",s),s}},Oe=async o=>{try{console.log("ðŸ” getPostBySlug called with slug:",o);const e=D(R(k,A),H("slug","==",o));console.log("ðŸ” Executing Firestore query...");const s=await te(e);if(console.log("ðŸ” Query result - empty?",s.empty),s.empty)throw console.log("âŒ No post found with slug:",o),new Error("Post not found");let r=null;s.forEach(j=>{r=j});const i=r.data(),n=P.currentUser?.uid;console.log("ðŸ” Post data:",{slug:i.slug,status:i.status,isPublished:i.isPublished,title:i.title}),console.log("ðŸ” Current user ID:",n),console.log("ðŸ” Checking permissions...");const a=await Pe(i,n);if(console.log("ðŸ” Can view post:",a),!a)throw console.log("âŒ Permission denied for post:",i.title),new Error("You do not have permission to view this post");if(i.status===v.PUBLISHED&&n)try{await K(r.ref,{views:(i.views||0)+1}),console.log("ðŸ“ˆ View count updated")}catch(j){console.log("âš ï¸ Could not update view count (guest user):",j.message)}const c={id:r.id,...i,publishedAt:i.publishedAt?.toDate(),createdAt:i.createdAt?.toDate(),updatedAt:i.updatedAt?.toDate(),views:(i.views||0)+(i.status===v.PUBLISHED&&n?1:0)};return n?(c.likeCount=await T(r.id),c.userHasLiked=await oe(r.id,n)):(c.likeCount=await T(r.id),c.userHasLiked=!1),c}catch(e){throw console.error("Error getting post by slug:",e),e}},Pe=async(o,e)=>{console.log("ðŸ” canUserViewPost called:",{userId:e,postStatus:o.status,postIsPublished:o.isPublished,postTitle:o.title});const s=o.status===v.PUBLISHED||o.isPublished===!0;if(console.log("ðŸ” Post is published?",s),s)return console.log("âœ… Post is published, allowing access to everyone"),!0;if(console.log("ðŸ” Post is not published, checking user permissions..."),!e)return console.log("âŒ Guest user trying to access unpublished post"),!1;if(console.log("ðŸ” Checking author permissions..."),o.authorId===e)return console.log("âœ… User is the author"),!0;console.log("ðŸ” Checking admin permissions for authenticated user...");try{const r=await w(e,"view:all-posts");return console.log("ðŸ” Has admin access:",r),r}catch(r){return console.error("âŒ Error checking admin permissions:",r),!1}},qe=async(o,e)=>e?!!(await w(e,"blog:write-all")||o.authorId===e&&await w(e,"blog:write-own")):!1,We=async(o,e)=>e?!!(await w(e,"blog:publish-all")||o.authorId===e&&await w(e,"blog:publish-own")):!1,_e=async(o,e)=>e?!!(await w(e,"blog:delete-all")||o.authorId===e&&await w(e,"blog:delete-own")):!1,ct=(o,e=150)=>{const s=o.replace(/#{1,6}\s+/g,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/`([^`]+)`/g,"$1").trim();return s.length<=e?s:s.substring(0,e).trim()+"..."};function Fe(){const{slug:o}=Le(),e=Ne(),[s,r]=h.useState(null),[i,n]=h.useState(!0),[a,c]=h.useState(""),[j,g]=h.useState(!1),[x,y]=h.useState(!1),[d,m]=h.useState(!1),[L,N]=h.useState(""),{theme:X}=h.useContext(se),{isLoggedIn:q}=h.useContext(ee),f=X==="dark";h.useEffect(()=>{o&&(async()=>{try{n(!0);const b=await Oe(o);r(b),ie(b)}catch(b){console.error("Error fetching post:",b),c(b.message||"Post not found or failed to load.")}finally{n(!1)}})()},[o]);const ie=l=>{document.title=`${l.title} - Orient Way`;const b=document.querySelector('meta[name="description"]');b&&b.setAttribute("content",l.excerpt||l.title),W(l)},W=l=>{const F=`${window.location.origin}/blog/${l.slug}`,u=(S,I)=>{let C=document.querySelector(`meta[property="${S}"]`);C||(C=document.createElement("meta"),C.setAttribute("property",S),document.head.appendChild(C)),C.setAttribute("content",I)};u("og:title",l.title),u("og:description",l.excerpt||l.title),u("og:url",F),u("og:type","article"),l.coverImage&&u("og:image",l.coverImage),u("article:published_time",l.publishedAt?.toISOString()),u("article:author",l.author||"Orient Way"),l.tags&&l.tags.length>0&&l.tags.forEach(S=>{const I=document.createElement("meta");I.setAttribute("property","article:tag"),I.setAttribute("content",S),document.head.appendChild(I)}),u("twitter:card","summary_large_image"),u("twitter:title",l.title),u("twitter:description",l.excerpt||l.title),l.coverImage&&u("twitter:image",l.coverImage)},ne=async()=>{if(console.log("ðŸ” handleLike called, isLoggedIn:",q),!q){console.log("ðŸš« User not logged in, showing toast"),N("ðŸ˜Š è¯·å…ˆæ³¨å†Œå¹¶ç™»å½•æ‰èƒ½ç‚¹èµžæ–‡ç« ï¼åªæœ‰æ³¨å†Œç”¨æˆ·æ‰èƒ½è¡¨è¾¾å¯¹æ–‡ç« çš„å–œçˆ±ã€‚"),m(!0);return}try{g(!0);const l=await ve(s.id,P.currentUser?.uid);r(b=>({...b,userHasLiked:l.liked,likeCount:l.total})),N(l.message),m(!0)}catch(l){console.error("Error toggling like:",l),N("ç‚¹èµžæ“ä½œå¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•"),m(!0)}finally{g(!1)}},_=l=>{const b=window.location.href,F=s.title;s.excerpt;let u="";switch(l){case"x":u=`https://x.com/intent/tweet?text=${encodeURIComponent(F)}&url=${encodeURIComponent(b)}`;break;case"linkedin":u=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(b)}`;break;case"copy":navigator.clipboard.writeText(b),N("Link copied to clipboard!"),m(!0),y(!1);return;default:return}u&&(window.open(u,"_blank","width=600,height=400"),y(!1))};if(i)return t.jsx(de,{className:"py-5",children:t.jsxs("div",{className:"text-center",children:[t.jsx(G,{animation:"border",variant:"primary"}),t.jsx("p",{className:"mt-2 text-muted",children:"Loading post..."})]})});if(a||!s)return t.jsx(de,{className:"py-5",children:t.jsxs(he,{variant:"danger",className:"text-center",children:[t.jsx("h4",{children:"Post Not Found"}),t.jsx("p",{children:a||"The post you are looking for does not exist."}),t.jsx(U,{variant:"primary",onClick:()=>e("/"),children:"Back to Home"})]})});const me=l=>l?l.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",ae=l=>l?l.split(`
`).map((u,S)=>{if(u.startsWith("# "))return t.jsx("h2",{style:{fontSize:"1.75rem",fontWeight:"700",marginTop:S>0?"2rem":"0",marginBottom:"1rem",color:f?"#f8f9fa":"#212529"},children:u.substring(2)},S);if(u.startsWith("## "))return t.jsx("h3",{style:{fontSize:"1.5rem",fontWeight:"600",marginTop:"1.5rem",marginBottom:"0.75rem",color:f?"#f8f9fa":"#212529"},children:u.substring(3)},S);if(u.startsWith("### "))return t.jsx("h4",{style:{fontSize:"1.25rem",fontWeight:"600",marginTop:"1.25rem",marginBottom:"0.5rem",color:f?"#f8f9fa":"#212529"},children:u.substring(4)},S);if(u.includes("**")){const I=u.split("**");return t.jsx("p",{style:{marginBottom:"1rem"},children:I.map((C,V)=>V%2===1?t.jsx("strong",{children:C},V):C)},S)}if(u.includes("*")&&!u.includes("**")){const I=u.split("*");return t.jsx("p",{style:{marginBottom:"1rem"},children:I.map((C,V)=>V%2===1?t.jsx("em",{children:C},V):C)},S)}return u.startsWith("- ")?t.jsx("li",{style:{marginBottom:"0.5rem",listStyle:"disc",marginLeft:"1.5rem"},children:u.substring(2)},S):u.trim()===""?t.jsx("br",{},S):t.jsx("p",{style:{marginBottom:"1rem"},children:u},S)}):"",le={fontSize:"1.1rem",lineHeight:"1.7",color:f?"#e9ecef":"#333"},ge={fontWeight:"700",lineHeight:"1.2",color:f?"#f8f9fa":"inherit"},ce={fontSize:"1.2rem",fontWeight:"400",lineHeight:"1.4",color:f?"#adb5bd":"#6c757d"},Q={backgroundColor:f?"rgba(255, 255, 255, 0.1)":"rgba(108, 117, 125, 0.1)",color:f?"#adb5bd":"#6c757d",border:"none",padding:"0.25rem 0.5rem",borderRadius:"0.375rem",fontSize:"0.875rem"},p={color:f?"#adb5bd":"#6c757d"},E={borderColor:f?"#495057":"#dee2e6"};return t.jsxs(de,{fluid:!0,style:{maxWidth:"1200px",padding:"1rem"},children:[t.jsxs(Ee,{className:"g-4",children:[t.jsx(fe,{lg:4,xl:3,children:t.jsx(Re,{})}),t.jsxs(fe,{lg:8,xl:9,children:[t.jsx("div",{className:"mb-3",children:t.jsxs(U,{variant:"outline-secondary",size:"sm",onClick:()=>e("/"),className:"d-flex align-items-center gap-2",children:[t.jsx("i",{className:"bi bi-arrow-left"}),"Back to Home"]})}),t.jsxs("article",{children:[t.jsxs("div",{className:"d-flex flex-wrap align-items-center gap-3 mb-3",children:[s.category&&t.jsx(ue,{bg:"primary",className:"text-uppercase",children:s.category}),t.jsx("small",{style:p,children:me(s.publishedAt)}),s.readTime&&t.jsxs("small",{style:p,children:[s.readTime," min read"]}),s.views&&t.jsxs("small",{style:p,children:[s.views," views"]})]}),t.jsx("h1",{className:"mb-2",style:ge,children:s.title}),s.subtitle&&t.jsx("h2",{className:"mb-4",style:ce,children:s.subtitle}),s.coverImage&&t.jsx("div",{className:"mb-4",children:t.jsx("img",{src:s.coverImage,alt:s.title,className:"img-fluid rounded",style:{width:"100%",height:"auto"}})}),t.jsx("div",{className:"mb-4",style:le,children:t.jsx("div",{children:ae(s.content)})}),s.tags&&s.tags.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h6",{style:p,className:"mb-2",children:"Tags:"}),t.jsx("div",{className:"d-flex flex-wrap gap-2",children:s.tags.map((l,b)=>t.jsx("span",{style:Q,children:l},b))})]}),t.jsxs("div",{className:"d-flex gap-3 py-3 border-top",style:E,children:[t.jsxs(U,{variant:s.userHasLiked?"primary":"outline-primary",size:"sm",onClick:ne,disabled:j,title:q?"ç‚¹èµžè¿™ç¯‡æ–‡ç« ":"è¯·å…ˆç™»å½•æ‰èƒ½ç‚¹èµž",style:q?{}:{opacity:.7},children:[t.jsx("i",{className:`bi ${s.userHasLiked?"bi-heart-fill":"bi-heart"} me-1`}),j?"Loading...":`Like${s.likeCount>0?` (${s.likeCount})`:""}`]}),t.jsxs(U,{variant:"outline-secondary",size:"sm",onClick:()=>y(!0),children:[t.jsx("i",{className:"bi bi-share me-1"}),"Share"]}),t.jsx(pe,{permission:"blog:write-own",children:s.authorId===P.currentUser?.uid&&t.jsxs(U,{variant:"outline-info",size:"sm",onClick:()=>e(`/editor/${s.id}`),children:[t.jsx("i",{className:"bi bi-pencil me-1"}),"Edit"]})}),t.jsx(pe,{permission:"blog:publish-all",children:t.jsxs(U,{variant:s.status==="published"?"outline-warning":"outline-success",size:"sm",onClick:()=>{s.status==="published"?console.log("Unpublish post"):console.log("Publish post")},children:[t.jsx("i",{className:`bi ${s.status==="published"?"bi-eye-slash":"bi-eye"} me-1`}),s.status==="published"?"Unpublish":"Publish"]})})]})]})]})]}),t.jsxs(Z,{show:x,onHide:()=>y(!1),centered:!0,children:[t.jsx(Z.Header,{closeButton:!0,style:{backgroundColor:f?"#2d3748":"#fff",borderColor:f?"#4a5568":"#dee2e6"},children:t.jsx(Z.Title,{style:{color:f?"#f7fafc":"#1a202c"},children:"Share this post"})}),t.jsx(Z.Body,{style:{backgroundColor:f?"#2d3748":"#fff",color:f?"#f7fafc":"#1a202c"},children:t.jsxs("div",{className:"d-grid gap-2",children:[t.jsxs(U,{variant:"outline-primary",onClick:()=>_("x"),className:"d-flex align-items-center justify-content-start",children:[t.jsx("i",{className:"bi bi-twitter-x me-2"}),"Share on X"]}),t.jsxs(U,{variant:"outline-primary",onClick:()=>_("linkedin"),className:"d-flex align-items-center justify-content-start",children:[t.jsx("i",{className:"bi bi-linkedin me-2"}),"Share on LinkedIn"]}),t.jsxs(U,{variant:"outline-secondary",onClick:()=>_("copy"),className:"d-flex align-items-center justify-content-start",children:[t.jsx("i",{className:"bi bi-clipboard me-2"}),"Copy link"]})]})})]}),t.jsx(Ae,{position:"top-end",className:"p-3",children:t.jsx(J,{show:d,onClose:()=>m(!1),delay:3e3,autohide:!0,bg:f?"dark":"light",children:t.jsx(J.Body,{style:{color:f?"#f7fafc":"#1a202c"},children:L})})})]})}const dt=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{Re as A,Ze as B,v as P,se as T,Xe as a,Je as b,Qe as c,ot as d,it as e,$e as f,rt as g,st as h,at as i,ct as j,tt as k,lt as l,dt as m,nt as p,ke as u,et as w};
