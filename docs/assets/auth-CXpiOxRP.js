import{j as e}from"./vendor-bootstrap-Dg_DQlAt.js";import{r,u as v,L as f,a as k}from"./vendor-router-DblBPfa5.js";import{i as E,g as C,a as P,s as T,b as L,c as B,d as A,u as I,e as R,o as _}from"./vendor-firebase-CynBMA2D.js";const j=r.createContext(null),M={apiKey:"AIzaSyCuyUsRMqyWadJGoQMx30ksAMFMG9U1j1A",authDomain:"orientingway.firebaseapp.com",projectId:"orientingway",storageBucket:"orientingway.firebasestorage.app",messagingSenderId:"321906289343",appId:"1:321906289343:web:9365f767c4b48eb522740a"},S=E(M),m=C(S),Y=P(S);async function q({email:a,password:s,nickname:n}){try{const t=await A(m,a,s);return n&&await I(t.user,{displayName:n}),{ok:!0}}catch(t){const o={"auth/email-already-in-use":"This email is already registered.","auth/invalid-email":"Invalid email address.","auth/weak-password":"Password should be at least 6 characters."};throw new Error(o[t.code]||t.message)}}async function z({email:a,password:s}){try{const t=(await B(m,a,s)).user;return{token:await t.getIdToken(),user:{email:t.email,nickname:t.displayName||t.email.split("@")[0]}}}catch(n){const t={"auth/user-not-found":"Invalid email or password.","auth/wrong-password":"Invalid email or password.","auth/invalid-email":"Invalid email address.","auth/user-disabled":"This account has been disabled.","auth/invalid-credential":"Invalid email or password."};throw new Error(t[n.code]||n.message)}}async function F(){try{return await R(m),{ok:!0}}catch(a){throw new Error(a.message)}}async function N(a=null){try{const s=a||m.currentUser;if(!s)throw new Error("No user is currently signed in.");return await T(s),{ok:!0}}catch(s){const n={"auth/too-many-requests":"Too many requests. Please try again later.","auth/user-not-found":"User not found."};throw new Error(n[s.code]||s.message)}}async function O(a){try{return await L(m,a),{ok:!0}}catch(s){const n={"auth/user-not-found":"No account found with this email address.","auth/invalid-email":"Invalid email address.","auth/too-many-requests":"Too many requests. Please try again later."};throw new Error(n[s.code]||s.message)}}function J(){return m.currentUser?.emailVerified||!1}async function K(){m.currentUser&&await m.currentUser.reload()}function Q({children:a}){const[{token:s,user:n},t]=r.useState({token:null,user:null}),[o,h]=r.useState(!0),i=!!s;r.useEffect(()=>{const u=_(m,async l=>{if(l)try{const d=await l.getIdToken();t({token:d,user:{email:l.email,nickname:l.displayName||l.email.split("@")[0]}})}catch(d){console.error("Error getting token:",d),t({token:null,user:null})}else t({token:null,user:null});h(!1)});return()=>u()},[]);const y=async u=>{const l=await z(u);t({token:l.token,user:l.user})},g=async u=>{await q(u)},c=async()=>{await F(),t({token:null,user:null})},p=r.useMemo(()=>({isLoggedIn:i,token:s||null,user:n||null,login:y,register:g,logout:c,loading:o}),[i,s,n,o]);return o?e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}):e.jsx(j.Provider,{value:p,children:a})}function W(){const a=r.useContext(j),s=v(),[n,t]=r.useState(""),[o,h]=r.useState(""),[i,y]=r.useState(""),[g,c]=r.useState(""),[p,u]=r.useState(!1),[l,d]=r.useState(!1),b=async x=>{x.preventDefault(),c(""),u(!1),d(!0);try{await a.register({email:n,password:i,nickname:o});try{await N()}catch(w){console.warn("Failed to send verification email:",w)}u(!0),setTimeout(()=>s("/login"),600)}catch(w){c(w.message||"Sign-up failed.")}finally{d(!1)}};return e.jsxs("form",{onSubmit:b,style:{maxWidth:800,padding:"1rem"},children:[e.jsx("h1",{children:"Create account"}),p&&e.jsx("div",{style:{color:"green",marginBottom:8},children:"Registration successful. Redirecting to sign-in‚Ä¶"}),g&&e.jsx("div",{style:{color:"crimson",marginBottom:8},children:g}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{children:"Email"}),e.jsx("br",{}),e.jsx("input",{type:"email",value:n,onChange:x=>t(x.target.value),required:!0})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{children:"Nickname (optional)"}),e.jsx("br",{}),e.jsx("input",{value:o,onChange:x=>h(x.target.value)})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{children:"Password"}),e.jsx("br",{}),e.jsx("input",{type:"password",value:i,onChange:x=>y(x.target.value),required:!0})]}),e.jsx("button",{type:"submit",disabled:l,children:l?"Submitting...":"Sign up"}),e.jsxs("div",{style:{marginTop:8},children:["Already have an account? ",e.jsx(f,{to:"/login",children:"Sign in"})]})]})}const X=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));function $(){const a=r.useContext(j),s=v(),t=k().state?.from?.pathname||"/",[o,h]=r.useState(""),[i,y]=r.useState(""),[g,c]=r.useState(""),[p,u]=r.useState(!1);if(a?.isLoggedIn)return e.jsxs("div",{style:{maxWidth:800,padding:"1rem"},children:[e.jsx("h1",{children:"Already signed in"}),e.jsxs("p",{children:["Go to ",e.jsx(f,{to:"/",children:"Home"})," or ",e.jsx(f,{to:"/logout",children:"Sign out"}),"."]})]});const l=async d=>{d.preventDefault(),c(""),u(!0);try{await a.login({email:o,password:i}),s(t,{replace:!0})}catch(b){c(b.message||"Sign-in failed.")}finally{u(!1)}};return e.jsxs("form",{onSubmit:l,style:{maxWidth:800,padding:"1rem"},children:[e.jsx("h1",{children:"Sign in"}),g&&e.jsx("div",{style:{color:"crimson",marginBottom:8},children:g}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{children:"Email"}),e.jsx("br",{}),e.jsx("input",{type:"email",value:o,onChange:d=>h(d.target.value),required:!0})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{children:"Password"}),e.jsx("br",{}),e.jsx("input",{type:"password",value:i,onChange:d=>y(d.target.value),required:!0})]}),e.jsx("div",{style:{marginBottom:12},children:e.jsx(f,{to:"/forgot-password",style:{fontSize:14},children:"Forgot password?"})}),e.jsx("button",{type:"submit",disabled:p,children:p?"Signing in...":"Sign in"}),e.jsxs("div",{style:{marginTop:8},children:["New user? ",e.jsx(f,{to:"/register",children:"Create an account"})]})]})}const Z=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));function U(){const a=r.useContext(j),[s,n]=r.useState(!1),t=v();return r.useEffect(()=>{a.logout().then(()=>n(!0))},[]),e.jsxs("div",{style:{maxWidth:800,padding:"1rem"},children:[e.jsx("h1",{children:"Sign out"}),e.jsx("div",{style:{marginTop:8},children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"green"},children:"You have been signed out."}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("button",{onClick:()=>t("/"),children:"Go to Home"}),e.jsx("span",{style:{marginLeft:8},children:e.jsx(f,{to:"/login",children:"Sign in again"})})]})]}):"Signing out‚Ä¶"})]})}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));function D(){const[a,s]=r.useState(""),[n,t]=r.useState(""),[o,h]=r.useState(!1),[i,y]=r.useState(!1),g=async c=>{c.preventDefault(),t(""),h(!1),y(!0);try{await O(a),h(!0),s("")}catch(p){t(p.message||"Failed to send reset email.")}finally{y(!1)}};return e.jsxs("div",{style:{maxWidth:420,padding:"1rem"},children:[e.jsx("h3",{children:"Reset Password"}),e.jsx("p",{style:{color:"#666",marginBottom:"1rem"},children:"Enter your email address and we'll send you a link to reset your password."}),o&&e.jsxs("div",{style:{color:"green",marginBottom:16,padding:12,backgroundColor:"#d4edda",border:"1px solid #c3e6cb",borderRadius:4},children:[e.jsx("strong",{children:"‚úì Email sent!"}),e.jsx("p",{style:{margin:"8px 0 0 0"},children:"Check your inbox for password reset instructions. The link will expire in 1 hour."})]}),n&&e.jsx("div",{style:{color:"crimson",marginBottom:16,padding:12,backgroundColor:"#f8d7da",border:"1px solid #f5c6cb",borderRadius:4},children:n}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{htmlFor:"email",style:{display:"block",marginBottom:4},children:"Email Address"}),e.jsx("input",{id:"email",type:"email",value:a,onChange:c=>s(c.target.value),required:!0,placeholder:"your@email.com",style:{width:"100%",padding:8,fontSize:16,border:"1px solid #ccc",borderRadius:4}})]}),e.jsx("button",{type:"submit",disabled:i,style:{padding:"10px 20px",fontSize:16,backgroundColor:i?"#ccc":"#007bff",color:"white",border:"none",borderRadius:4,cursor:i?"not-allowed":"pointer",width:"100%"},children:i?"Sending...":"Send Reset Link"})]}),e.jsx("div",{style:{marginTop:16,textAlign:"center"},children:e.jsx(f,{to:"/login",children:"‚Üê Back to Sign In"})}),e.jsxs("div",{style:{marginTop:24,padding:12,backgroundColor:"#e7f3ff",border:"1px solid #b3d9ff",borderRadius:4,fontSize:14},children:[e.jsx("strong",{children:"üí° Note:"}),e.jsxs("ul",{style:{margin:"8px 0 0 0",paddingLeft:20},children:[e.jsx("li",{children:"Check your spam folder if you don't see the email"}),e.jsx("li",{children:"The reset link expires in 1 hour"}),e.jsx("li",{children:"You can request a new link if needed"})]})]})]})}const te=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));export{Q as A,te as F,j as L,X as R,Z as a,ee as b,Y as d,J as i,K as r,N as s};
