import{j as e,b as Y,A as z,R as D,c as y,a as h,C as G,h as Z,B as $,M as c,F as s,S as ee}from"./vendor-bootstrap-C6xIMti8.js";import{r as n}from"./vendor-router-DArSVHJ3.js";import{T as te,d as se}from"./blog-BRW7BTWu.js";import{c as H,b as ae,e as O,p as ne,h as T,r as oe,d as re}from"./vendor-firebase-CYcY3q11.js";import{d as C}from"./auth-Sw-QPVcd.js";import"./vendor-react-Bzgz95E1.js";const b="mapPoints",le=async()=>{try{const o=H(C,b),a=await ae(o),l=[];return a.forEach(x=>{l.push({id:x.id,...x.data()})}),l}catch(o){throw console.error("Error getting map points:",o),o}},ie=async o=>{try{return(await oe(H(C,b),{...o,createdAt:T(),updatedAt:T()})).id}catch(a){throw console.error("Error creating map point:",a),a}},ce=async(o,a)=>{try{const l=O(C,b,o);await ne(l,{...a,updatedAt:T()})}catch(l){throw console.error("Error updating map point:",l),l}},de=async o=>{try{const a=O(C,b,o);await re(a)}catch(a){throw console.error("Error deleting map point:",a),a}};function fe(){const[o,a]=n.useState([]),[l,x]=n.useState([]),[q,M]=n.useState(!0),[Q,E]=n.useState(!1),[A,u]=n.useState(""),[F,m]=n.useState(""),{theme:he}=n.useContext(te),[W,I]=n.useState(!1),[j,w]=n.useState(null),[U,g]=n.useState(!1),[v,k]=n.useState(null),[P,B]=n.useState(""),[i,f]=n.useState({title:"",coords:[0,0],status:"planned",postId:""});n.useEffect(()=>{N(),_()},[]);const N=async()=>{try{M(!0),u("");const t=await le();a(t.sort((r,d)=>(d.createdAt?.toDate()||new Date)-(r.createdAt?.toDate()||new Date)))}catch(t){u("Failed to load map points: "+t.message),console.error(t)}finally{M(!1)}},_=async()=>{try{E(!0);const t=await se(1e3,{status:"published-only"});x(t.filter(r=>r.title&&r.id))}catch(t){console.warn("Failed to load posts:",t),x([])}finally{E(!1)}},R=(t=null)=>{t?(w(t.id),f({title:t.title||"",coords:t.coords||[0,0],status:t.status||"planned",postId:t.postId||""})):(w(null),f({title:"",coords:[0,0],status:"planned",postId:""})),B(""),I(!0)},S=()=>{I(!1),w(null)},p=t=>{const{name:r,value:d}=t.target;if(r==="latitude"||r==="longitude"){const L=[...i.coords];r==="latitude"?L[0]=parseFloat(d)||0:L[1]=parseFloat(d)||0,f({...i,coords:L})}else f({...i,[r]:d})},J=async()=>{try{if(!i.title.trim()){u("Title is required");return}j?(await ce(j,i),m("Point updated successfully!")):(await ie(i),m("Point created successfully!")),S(),await N(),setTimeout(()=>m(""),3e3)}catch(t){u("Error saving point: "+t.message),console.error(t)}},K=t=>{k(t),g(!0)},V=async()=>{if(v)try{await de(v.id),m("Point deleted successfully!"),g(!1),k(null),await N(),setTimeout(()=>m(""),3e3)}catch(t){u("Error deleting point: "+t.message),console.error(t)}};if(q)return e.jsx("div",{className:"text-center p-4",children:"Loading map points..."});const X={};return e.jsxs(Y,{fluid:!0,style:{maxWidth:"1400px",padding:"2rem 1rem"},children:[A&&e.jsx(z,{variant:"danger",onClose:()=>u(""),dismissible:!0,children:A}),F&&e.jsx(z,{variant:"success",onClose:()=>m(""),dismissible:!0,children:F}),e.jsx(D,{className:"mb-4",children:e.jsx(y,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1",children:"Passport Management"}),e.jsx("p",{className:"text-muted mb-0",children:"Manage travel map points and locations"})]}),e.jsxs(h,{variant:"primary",onClick:()=>R(),children:[e.jsx("i",{className:"bi bi-plus-lg me-2"}),"Add Point"]})]})})}),e.jsx(D,{children:e.jsx(y,{children:e.jsx(G,{style:X,children:e.jsx(G.Body,{children:e.jsxs(Z,{responsive:!0,hover:!0,className:"mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Latitude"}),e.jsx("th",{children:"Longitude"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Post ID"}),e.jsx("th",{style:{width:"160px"},className:"text-end",children:"Actions"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-muted",children:"No map points yet. Create your first point to get started!"})}):o.map(t=>{const r=l.find(d=>d.id===t.postId);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:t.title})}),e.jsx("td",{className:"font-monospace",children:t.coords?.[0]?.toFixed(4)||"-"}),e.jsx("td",{className:"font-monospace",children:t.coords?.[1]?.toFixed(4)||"-"}),e.jsx("td",{children:e.jsx($,{bg:t.status==="completed"?"success":"warning",className:"text-capitalize",children:t.status})}),e.jsx("td",{children:r?r.title:"-"}),e.jsxs("td",{className:"text-end",children:[e.jsx(h,{variant:"outline-info",size:"sm",onClick:()=>R(t),className:"me-2",children:e.jsx("i",{className:"bi bi-pencil"})}),e.jsx(h,{variant:"outline-danger",size:"sm",onClick:()=>K(t),children:e.jsx("i",{className:"bi bi-trash"})})]})]},t.id)})})]})})})})}),e.jsxs(c,{show:W,onHide:S,centered:!0,size:"lg",children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:j?"Edit Point":"Add New Point"})}),e.jsx(c.Body,{children:e.jsxs(s,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Title *"}),e.jsx(s.Control,{type:"text",name:"title",value:i.title,onChange:p,placeholder:"e.g., Taiwan Trip, Madison, West Lake"})]}),e.jsxs(D,{children:[e.jsx(y,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Latitude *"}),e.jsx(s.Control,{type:"number",name:"latitude",value:i.coords[0],onChange:p,step:"0.0001",placeholder:"e.g., 25.0330"})]})}),e.jsx(y,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Longitude *"}),e.jsx(s.Control,{type:"number",name:"longitude",value:i.coords[1],onChange:p,step:"0.0001",placeholder:"e.g., 121.5654"})]})})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Status"}),e.jsxs(s.Select,{name:"status",value:i.status,onChange:p,children:[e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Associated Post (Optional)"}),Q?e.jsxs("div",{className:"text-muted",children:[e.jsx(ee,{animation:"border",size:"sm",className:"me-2"}),"Loading posts..."]}):e.jsxs(e.Fragment,{children:[e.jsx(s.Control,{type:"text",placeholder:"Search posts by title...",value:P,onChange:t=>B(t.target.value),className:"mb-2"}),e.jsxs(s.Select,{name:"postId",value:i.postId,onChange:p,size:Math.min(l.filter(t=>t.title.toLowerCase().includes(P.toLowerCase())).length+1,8),children:[e.jsx("option",{value:"",children:"-- No post --"}),l.filter(t=>t.title.toLowerCase().includes(P.toLowerCase())).map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsx(s.Text,{className:"text-muted",children:"Search and select a published blog post to show preview on map"})]})]})}),e.jsxs(c.Footer,{children:[e.jsx(h,{variant:"secondary",onClick:S,children:"Cancel"}),e.jsx(h,{variant:"primary",onClick:J,children:j?"Update Point":"Create Point"})]})]}),e.jsxs(c,{show:U,onHide:()=>g(!1),centered:!0,children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:"Delete Point"})}),e.jsx(c.Body,{children:e.jsxs("p",{className:"mb-0",children:["Are you sure you want to delete ",e.jsx("strong",{children:v?.title}),"? This action cannot be undone."]})}),e.jsxs(c.Footer,{children:[e.jsx(h,{variant:"secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx(h,{variant:"danger",onClick:V,children:"Delete Point"})]})]})]})}export{fe as default};
