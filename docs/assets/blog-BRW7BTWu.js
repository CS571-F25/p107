import{j as e,C as G,B as ue,a as I,T as ee,S as K,A as he,b as de,R as Ce,c as fe,M as J,d as Ae}from"./vendor-bootstrap-C6xIMti8.js";import{r as h,L as Le,u as be,c as Ne}from"./vendor-router-DArSVHJ3.js";import{R as B,a as L,L as te,g as we,c as Ue,b as Te,i as Ie,h as w,d as P,l as $}from"./auth-Sw-QPVcd.js";import{o as Me,q as H,c as z,w as M,b as se,e as R,f as O,d as ye,s as Be,h as D,p as X,r as He}from"./vendor-firebase-CYcY3q11.js";const Q=h.createContext();function Xe({children:r}){const[t,s]=h.useState(localStorage.getItem("theme")||"light");h.useEffect(()=>{localStorage.setItem("theme",t),document.documentElement.setAttribute("data-bs-theme",t)},[t]);const o=()=>{const a=t==="dark"?"light":"dark";s(a),localStorage.setItem("theme",a)},n=h.useMemo(()=>({theme:t,toggleTheme:o}),[t]);return e.jsx(Q.Provider,{value:n,children:r})}const xe=()=>L.currentUser?.uid||null,ke=r=>{const[t,s]=h.useState(!1),[o,n]=h.useState(!0),{isLoggedIn:a}=h.useContext(te);return h.useEffect(()=>{(async()=>{try{n(!0);const i=xe(),j=await w(i,r);s(j)}catch(i){console.error("Error checking permission:",i),s(!1)}finally{n(!1)}})()},[r,a]),{hasAccess:t,loading:o}},Qe=r=>{const[t,s]=h.useState({canRead:!0,canEdit:!1,canDelete:!1,canPublish:!1}),[o,n]=h.useState(!0),{isLoggedIn:a}=h.useContext(te);return h.useEffect(()=>{(async()=>{try{n(!0);const i=xe();if(!i){s({canRead:!0,canEdit:!1,canDelete:!1,canPublish:!1});return}const[j,f,y]=await Promise.all([w(i,"blog:write-all"),w(i,"blog:publish-all"),w(i,"blog:delete-all")]),c=i===r,d=await w(i,"blog:write-own"),g=await w(i,"blog:publish-own"),E=await w(i,"blog:delete-own");s({canRead:!0,canEdit:j||c&&d,canDelete:y||c&&E,canPublish:f||c&&g})}catch(i){console.error("Error checking post permissions:",i),s({canRead:!0,canEdit:!1,canDelete:!1,canPublish:!1})}finally{n(!1)}})()},[r,a]),{permissions:t,loading:o}},je=()=>{const[r,t]=h.useState({level:B.GUEST,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!0}),[s,o]=h.useState(0);h.useEffect(()=>{let l=!0;const i=async f=>{try{if(console.log("ðŸ”„ useUserPermissions: Checking permissions for user:",f,"refreshKey:",s),!l)return;if(!f){console.log("ðŸ”„ useUserPermissions: No user ID, setting guest permissions"),l&&t({level:B.GUEST,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!1});return}l&&t(v=>({...v,loading:!0})),console.log("ðŸ”„ useUserPermissions: Fetching all permissions...");const[y,c,d,g]=await Promise.all([we(f),Ue(f),Te(f),Ie(f)]);console.log("ðŸ”„ useUserPermissions: Got results:",{level:y,adminAccess:c,contentAccess:d,ownerStatus:g});const E={level:y,canAccessAdmin:c,canManageAll:d,isOwner:g,loading:!1};console.log("ðŸ”„ useUserPermissions: Setting new permissions:",E),l&&t(E)}catch(y){console.error("âŒ useUserPermissions: Error checking permissions:",y),l&&t({level:B.UNVERIFIED_USER,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!1})}};console.log("ðŸ”„ useUserPermissions: Setting up Firebase auth listener, refreshKey:",s);const j=Me(L,f=>{console.log("ðŸ”„ useUserPermissions: Auth state changed:",f?`logged in as ${f.uid}`:"logged out"),f?i(f.uid):l&&t({level:B.GUEST,canAccessAdmin:!1,canManageAll:!1,isOwner:!1,loading:!1})});return()=>{console.log("ðŸ”„ useUserPermissions: Cleaning up auth listener"),l=!1,j()}},[s]);const n=!!L.currentUser;return{...r,isLoggedIn:n,forceRefresh:()=>{console.log("ðŸ”„ useUserPermissions: Force refresh triggered"),o(l=>l+1)},isGuest:r.level===B.GUEST,isUnverifiedUser:r.level===B.UNVERIFIED_USER,isVerifiedUser:r.level===B.VERIFIED_USER,isAdmin:r.level<=B.ADMIN}};function Ze(){const{theme:r}=h.useContext(Q),t=[{text:"raised",description:" by West Lake in Hangzhou",linkClass:"theme-link link-blue",id:"raised"},{text:"learned to orienteer",description:" in high school",linkClass:"theme-link link-teal",id:"orienteer"},{text:"solo cycled",description:" around Taiwan and topped the highest road in SE Asia",linkClass:"theme-link link-red",id:"taiwan-ride"},{text:"bikepacked",description:" from the Midwest to the Pacific",linkClass:"theme-link link-brown",id:"backpacking"},{text:"now",description:" studying in Madison",linkClass:"theme-link link-blue",id:"madison"}],s={github:"https://github.com/eliotziqi",linkedin:"https://www.linkedin.com/in/zzhu-eliot/",twitter:"https://x.com/EliotOrientWay",email:"mailto:zhu.ziqi@foxmail.com"};return e.jsxs("div",{className:"sticky-top",style:{top:"2rem"},children:[e.jsx("div",{className:"mb-4 pb-4 title-hover-group",style:{position:"relative"},onMouseEnter:o=>{const n=o.currentTarget.querySelector(".title-tooltip");n&&(n.style.opacity="1")},onMouseLeave:o=>{const n=o.currentTarget.querySelector(".title-tooltip");n&&(n.style.opacity="0")},children:e.jsxs("div",{style:{cursor:"default"},children:[e.jsx("h1",{className:"mb-1 lh-1",style:{fontSize:"clamp(1.8rem, 6vw, 2.5rem)",fontWeight:"800",letterSpacing:"-0.03em",whiteSpace:"nowrap"},children:"OrientÂ Way"}),e.jsx("h2",{className:"mb-0 text-muted",style:{fontSize:"clamp(1rem, 3vw, 1.1rem)",fontWeight:"400",letterSpacing:"-0.015em",marginTop:"0.15rem"},children:"a blog by Eliot Zhu"}),e.jsx("small",{className:"text-muted title-tooltip",style:{fontSize:"0.7rem",lineHeight:"1.2",position:"absolute",top:"-1.2rem",left:"0",opacity:"0",transition:"opacity 0.3s ease",pointerEvents:"none",whiteSpace:"nowrap"},children:"find direction and move on"})]})}),e.jsx("div",{className:"mb-4",children:e.jsx("ul",{className:"list-unstyled mb-0",style:{fontSize:"0.95rem",lineHeight:"1.6"},children:t.map((o,n)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{className:"text-muted",children:"â€¢ "}),e.jsx("a",{href:"javascript:void(0);",className:o.linkClass,onClick:a=>a.preventDefault(),children:o.text}),e.jsx("span",{className:"text-muted",children:o.description})]},n))})}),e.jsxs("div",{className:"d-flex gap-3 mb-4",children:[e.jsx("a",{href:s.github,target:"_blank",rel:"noopener noreferrer",className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:o=>o.target.style.color="#333",onMouseLeave:o=>o.target.style.color="inherit",title:"GitHub",children:e.jsx("i",{className:"bi bi-github"})}),e.jsx("a",{href:s.linkedin,target:"_blank",rel:"noopener noreferrer",className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:o=>o.target.style.color="#0077b5",onMouseLeave:o=>o.target.style.color="inherit",title:"LinkedIn",children:e.jsx("i",{className:"bi bi-linkedin"})}),e.jsx("a",{href:s.twitter,target:"_blank",rel:"noopener noreferrer",className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:o=>o.target.style.color="#1da1f2",onMouseLeave:o=>o.target.style.color="inherit",title:"Twitter/X",children:e.jsx("i",{className:"bi bi-twitter-x"})}),e.jsx("a",{href:s.email,className:"text-reset",style:{fontSize:"1.3rem",transition:"color 0.2s ease"},onMouseEnter:o=>o.target.style.color="#6c757d",onMouseLeave:o=>o.target.style.color="inherit",title:"Email",children:e.jsx("i",{className:"bi bi-envelope"})})]})]})}const re="likes",ze=async(r,t)=>{try{if(!t)throw new Error("User must be logged in to like posts");if(await ve(r,t))return{liked:!0,total:await T(r),message:"Post already liked"};const o=`${r}_${t}`;return await Be(R(P,re,o),{postId:r,userId:t,createdAt:D()}),await $({actorId:t,action:"blog:like",entityType:"post",entityId:r,meta:{likeId:o}}),{liked:!0,total:await T(r),message:"Post liked successfully"}}catch(s){throw console.error("Error liking post:",s),s}},De=async(r,t)=>{try{if(!t)throw new Error("User must be logged in to unlike posts");const s=`${r}_${t}`,o=R(P,re,s);return(await O(o)).exists()?(await ye(o),await $({actorId:t,action:"blog:unlike",entityType:"post",entityId:r,meta:{likeId:s}}),{liked:!1,total:await T(r),message:"Post unliked successfully"}):{liked:!1,total:await T(r),message:"Post not previously liked"}}catch(s){throw console.error("Error unliking post:",s),s}},ve=async(r,t)=>{try{if(!t)return null;const s=`${r}_${t}`,o=await O(R(P,re,s));return o.exists()?{id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate()}:null}catch(s){return console.error("Error getting like:",s),null}},oe=async(r,t)=>!!await ve(r,t),T=async r=>{try{const t=H(z(P,re),M("postId","==",r));return(await se(t)).size}catch(t){return console.error("Error getting like count:",t),0}},Se=async(r,t)=>{try{return await oe(r,t)?await De(r,t):await ze(r,t)}catch(s){throw console.error("Error toggling like:",s),s}};function Je({post:r,theme:t="blue"}){const{theme:s}=h.useContext(Q),{isLoggedIn:o}=h.useContext(te),n=s==="dark",[a,l]=h.useState(!1),[i,j]=h.useState(r),[f,y]=h.useState(!1),[c,d]=h.useState(""),{id:g,slug:E,title:v,subtitle:W,excerpt:q,coverImage:p,category:ne,tags:F=[],publishedAt:ie,readTime:_,author:ge}=i,ae=async b=>{if(b.preventDefault(),b.stopPropagation(),console.log("ðŸ” BlogCard handleLike called, isLoggedIn:",o),!o){console.log("ðŸš« User not logged in, showing toast"),d("ðŸ˜Š è¯·å…ˆæ³¨å†Œå¹¶ç™»å½•æ‰èƒ½ç‚¹èµžæ–‡ç« ï¼åªæœ‰æ³¨å†Œç”¨æˆ·æ‰èƒ½è¡¨è¾¾å¯¹æ–‡ç« çš„å–œçˆ±ã€‚"),y(!0);return}try{l(!0);const N=await Se(i.id,L.currentUser?.uid);j(u=>({...u,userHasLiked:N.liked,likeCount:N.total})),d(N.message),y(!0)}catch(N){console.error("Error toggling like:",N),d("ç‚¹èµžæ“ä½œå¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•"),y(!0)}finally{l(!1)}},le=b=>{if(!b)return"";const N=new Date;return b.getFullYear()===N.getFullYear()?b.toLocaleDateString("en-US",{month:"long",day:"numeric"}):b.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},ce=(b=>({travel:"red",tech:"blue",life:"teal",review:"brown",startup:"brown",personal:"blue"})[b]||"blue")(ne),Z={fontSize:"0.7rem",backgroundColor:n?"rgba(255, 255, 255, 0.2)":"rgba(108, 117, 125, 0.8)",color:"#ffffff",border:n?"1px solid rgba(255, 255, 255, 0.3)":"1px solid rgba(108, 117, 125, 0.9)",fontWeight:"500",backdropFilter:n?"blur(8px)":"none"};return e.jsxs(G,{className:`h-100 shadow-sm border-0 mb-4 card card-${ce}`,children:[p&&e.jsx("div",{style:{height:"200px",overflow:"hidden"},children:e.jsx(G.Img,{variant:"top",src:p,alt:v,style:{width:"100%",height:"100%",objectFit:"cover",transition:"transform 0.3s ease"},onMouseEnter:b=>b.target.style.transform="scale(1.05)",onMouseLeave:b=>b.target.style.transform="scale(1)"})}),e.jsxs(G.Body,{className:"d-flex flex-column",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-start mb-2",children:e.jsx("div",{className:"card-date",children:le(ie)})}),e.jsx(Le,{to:`/blog/${E||g}`,className:"text-decoration-none text-reset",children:e.jsx(G.Title,{className:"mb-1 card-title",style:{fontSize:"1.2rem",lineHeight:"1.3"},children:v})}),W&&e.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.9rem",fontWeight:"500"},children:W}),e.jsx(G.Text,{className:"text-muted flex-grow-1",style:{fontSize:"0.85rem",lineHeight:"1.5"},children:q}),e.jsxs("div",{className:"mt-auto pt-2",children:[F.length>0&&e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[F.slice(0,3).map((b,N)=>e.jsx(ue,{variant:"outline-secondary",className:"border-0",style:Z,children:b},N)),F.length>3&&e.jsxs(ue,{variant:"outline-secondary",className:"border-0",style:Z,children:["+",F.length-3]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(I,{variant:i.userHasLiked?"primary":"outline-primary",size:"sm",onClick:ae,disabled:a,title:o?"ç‚¹èµžè¿™ç¯‡æ–‡ç« ":"è¯·å…ˆç™»å½•æ‰èƒ½ç‚¹èµž",style:{fontSize:"0.8rem",...o?{}:{opacity:.7}},children:[e.jsx("i",{className:`bi ${i.userHasLiked?"bi-heart-fill":"bi-heart"} me-1`}),a?"Loading...":`Like${i.likeCount>0?` (${i.likeCount})`:""}`]}),_&&e.jsxs("small",{className:"text-muted",children:[_," min read"]})]})]})]}),e.jsx(ee,{show:f,onClose:()=>y(!1),delay:3e3,autohide:!0,style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,maxWidth:"350px"},children:e.jsx(ee.Body,{children:c})})]})}function pe({permission:r,children:t,fallback:s=null,showLoading:o=!0}){const{hasAccess:n,loading:a}=ke(r);return a&&o?e.jsx(K,{animation:"border",size:"sm"}):n?t:s}function et({children:r,fallback:t=null,showLoading:s=!0}){const{canAccessAdmin:o,loading:n}=je();return n&&s?e.jsx(K,{animation:"border",size:"sm"}):o?r:t}function tt(r,t){return function(o){const{hasAccess:n,loading:a}=ke(t);return a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh"},children:e.jsx(K,{animation:"border",variant:"primary"})}):n?e.jsx(r,{...o}):e.jsxs(he,{variant:"danger",className:"text-center",children:[e.jsx("h4",{children:"Access Denied"}),e.jsx("p",{children:"You don't have permission to access this page."})]})}}function st(r){return function(s){const{canAccessAdmin:o,loading:n,level:a,isOwner:l}=je();return n?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh"},children:e.jsx(K,{animation:"border",variant:"primary"})}):o?e.jsx(r,{...s}):e.jsxs(he,{variant:"danger",className:"text-center",children:[e.jsx("h4",{children:"Admin Access Required"}),e.jsx("p",{children:"You need administrator privileges to access this page."}),e.jsx("div",{className:"mt-3",children:e.jsxs("small",{className:"text-muted",children:["Debug info: Level: ",a,", Owner: ",l?"Yes":"No"]})}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{className:"btn btn-warning",onClick:()=>window.location.reload(),children:"Refresh Permissions"})})]})}}const U="posts",C={DRAFT:"draft",PUBLISHED:"published",ARCHIVED:"archived"},rt=async r=>{try{const t=L.currentUser?.uid;if(!t)throw new Error("User must be logged in to create posts");if(!(await w(t,"blog:write-own")||await w(t,"blog:write-all")))throw new Error("You do not have permission to create posts");const o=r.slug||Re(r.title);await Ee(o);const n=await He(z(P,U),{...r,slug:o,authorId:t,status:r.status||C.DRAFT,publishedAt:r.status===C.PUBLISHED?D():null,createdAt:D(),updatedAt:D(),likes:0,views:0,isPublished:r.status===C.PUBLISHED||r.isPublished===!0});return await $({actorId:t,action:"blog:create",entityType:"post",entityId:n.id,meta:{status:r.status||C.DRAFT}}),n.id}catch(t){throw console.error("Error creating post:",t),t}},ot=async(r=10,t={})=>{try{const s=L.currentUser?.uid,{status:o="published-only",authorId:n=null,category:a=null}=t;let l;const i=s&&await w(s,"view:all-posts"),j=await we(s);o==="all"&&i?l=z(P,U):o==="drafts-only"&&i?l=H(z(P,U),M("status","==",C.DRAFT)):o==="my-drafts"&&s?l=H(z(P,U),M("authorId","==",s),M("status","==",C.DRAFT)):l=H(z(P,U),M("status","==",C.PUBLISHED)),n&&(l=H(l,M("authorId","==",n))),a&&(l=H(l,M("category","==",a)));const f=await se(l),y=[];f.forEach(d=>{const g=d.data();y.push({id:d.id,...g,publishedAt:g.publishedAt?.toDate(),createdAt:g.createdAt?.toDate(),updatedAt:g.updatedAt?.toDate()})});const c=y.filter(d=>d.status===C.PUBLISHED?!0:s?d.authorId===s?!0:i:!1).sort((d,g)=>{const E=d.publishedAt||d.createdAt||new Date(0);return(g.publishedAt||g.createdAt||new Date(0))-E}).slice(0,r);if(s)for(const d of c)try{d.likeCount=await T(d.id),d.userHasLiked=await oe(d.id,s)}catch(g){console.warn("Error fetching like info for post:",d.id,g),d.likeCount=d.likes||0,d.userHasLiked=!1}else for(const d of c)d.likeCount=await T(d.id),d.userHasLiked=!1;return c}catch(s){throw console.error("Error getting posts:",s),s}},nt=async r=>{try{const t=R(P,U,r),s=await O(t);if(!s.exists())throw new Error("Post not found");const o=s.data(),n=L.currentUser?.uid;if(!await Pe(o,n))throw new Error("You do not have permission to view this post");if(o.status===C.PUBLISHED&&n)try{await X(t,{views:(o.views||0)+1})}catch{console.log("Could not update view count (user may not have permission)")}const l={id:s.id,...o,publishedAt:o.publishedAt?.toDate(),createdAt:o.createdAt?.toDate(),updatedAt:o.updatedAt?.toDate(),views:(o.views||0)+(o.status===C.PUBLISHED&&n?1:0)};return n?(l.likeCount=await T(r),l.userHasLiked=await oe(r,n)):(l.likeCount=await T(r),l.userHasLiked=!1),l}catch(t){throw console.error("Error getting post:",t),t}},it=async(r,t)=>{try{const s=L.currentUser?.uid;if(!s)throw new Error("User must be logged in to update posts");const o=R(P,U,r),n=await O(o);if(!n.exists())throw new Error("Post not found");const a=n.data();if(!await Oe(a,s))throw new Error("You do not have permission to edit this post");t.slug&&t.slug!==a.slug&&await Ee(t.slug,r),await X(o,{...t,updatedAt:D()}),await $({actorId:s,action:"blog:update",entityType:"post",entityId:r,meta:{fields:Object.keys(t)}})}catch(s){throw console.error("Error updating post:",s),s}},at=async r=>{try{const t=L.currentUser?.uid;if(!t)throw new Error("User must be logged in to publish posts");const s=R(P,U,r),o=await O(s);if(!o.exists())throw new Error("Post not found");const n=o.data();if(!await We(n,t))throw new Error("You do not have permission to publish this post");if(!n.title||!n.content)throw new Error("Post must have title and content to be published");return await X(s,{status:C.PUBLISHED,isPublished:!0,publishedAt:D(),updatedAt:D()}),await $({actorId:t,action:"blog:publish",entityType:"post",entityId:r}),!0}catch(t){throw console.error("Error publishing post:",t),t}},lt=async r=>{try{const t=L.currentUser?.uid;if(!t)throw new Error("User must be logged in to unpublish posts");const s=R(P,U,r),o=await O(s);if(!o.exists())throw new Error("Post not found");const n=o.data();if(!(await w(t,"blog:publish-all")||n.authorId===t&&await w(t,"blog:publish-own")))throw new Error("You do not have permission to unpublish this post");return await X(s,{status:C.DRAFT,isPublished:!1,updatedAt:D()}),await $({actorId:t,action:"blog:unpublish",entityType:"post",entityId:r}),!0}catch(t){throw console.error("Error unpublishing post:",t),t}},ct=async r=>{try{const t=L.currentUser?.uid;if(!t)throw new Error("User must be logged in to delete posts");const s=R(P,U,r),o=await O(s);if(!o.exists())throw new Error("Post not found");const n=o.data();if(!await qe(n,t))throw new Error("You do not have permission to delete this post");return await ye(s),await $({actorId:t,action:"blog:delete",entityType:"post",entityId:r,meta:{title:n.title}}),!0}catch(t){throw console.error("Error deleting post:",t),t}},Re=r=>r.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),Ee=async(r,t=null)=>{try{const s=H(z(P,U),M("slug","==",r)),o=await se(s);let n=!0;if(o.forEach(a=>{t&&a.id===t||(n=!1)}),!n)throw new Error(`Slug "${r}" is already in use. Please choose a different one.`);return!0}catch(s){throw console.error("Error validating slug:",s),s}},$e=async r=>{try{console.log("ðŸ” getPostBySlug called with slug:",r);const t=H(z(P,U),M("slug","==",r));console.log("ðŸ” Executing Firestore query...");const s=await se(t);if(console.log("ðŸ” Query result - empty?",s.empty),s.empty)throw console.log("âŒ No post found with slug:",r),new Error("Post not found");let o=null;s.forEach(j=>{o=j});const n=o.data(),a=L.currentUser?.uid;console.log("ðŸ” Post data:",{slug:n.slug,status:n.status,isPublished:n.isPublished,title:n.title}),console.log("ðŸ” Current user ID:",a),console.log("ðŸ” Checking permissions...");const l=await Pe(n,a);if(console.log("ðŸ” Can view post:",l),!l)throw console.log("âŒ Permission denied for post:",n.title),new Error("You do not have permission to view this post");if(n.status===C.PUBLISHED&&a)try{await X(o.ref,{views:(n.views||0)+1}),console.log("ðŸ“ˆ View count updated")}catch(j){console.log("âš ï¸ Could not update view count (guest user):",j.message)}const i={id:o.id,...n,publishedAt:n.publishedAt?.toDate(),createdAt:n.createdAt?.toDate(),updatedAt:n.updatedAt?.toDate(),views:(n.views||0)+(n.status===C.PUBLISHED&&a?1:0)};return a?(i.likeCount=await T(o.id),i.userHasLiked=await oe(o.id,a)):(i.likeCount=await T(o.id),i.userHasLiked=!1),i}catch(t){throw console.error("Error getting post by slug:",t),t}},Pe=async(r,t)=>{console.log("ðŸ” canUserViewPost called:",{userId:t,postStatus:r.status,postIsPublished:r.isPublished,postTitle:r.title});const s=r.status===C.PUBLISHED||r.isPublished===!0;if(console.log("ðŸ” Post is published?",s),s)return console.log("âœ… Post is published, allowing access to everyone"),!0;if(console.log("ðŸ” Post is not published, checking user permissions..."),!t)return console.log("âŒ Guest user trying to access unpublished post"),!1;if(console.log("ðŸ” Checking author permissions..."),r.authorId===t)return console.log("âœ… User is the author"),!0;console.log("ðŸ” Checking admin permissions for authenticated user...");try{const o=await w(t,"view:all-posts");return console.log("ðŸ” Has admin access:",o),o}catch(o){return console.error("âŒ Error checking admin permissions:",o),!1}},Oe=async(r,t)=>t?!!(await w(t,"blog:write-all")||r.authorId===t&&await w(t,"blog:write-own")):!1,We=async(r,t)=>t?!!(await w(t,"blog:publish-all")||r.authorId===t&&await w(t,"blog:publish-own")):!1,qe=async(r,t)=>t?!!(await w(t,"blog:delete-all")||r.authorId===t&&await w(t,"blog:delete-own")):!1,dt=(r,t=150)=>{const s=r.replace(/#{1,6}\s+/g,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/`([^`]+)`/g,"$1").trim();return s.length<=t?s:s.substring(0,t).trim()+"..."};function Fe({content:r}){const[t,s]=h.useState([]),[o,n]=h.useState(!0),a=be(),{theme:l}=h.useContext(Q),i=l==="dark";h.useEffect(()=>{if(!r)return;const c=r.split(`
`),d=[];c.forEach(g=>{let E=0,v="";if(g.startsWith("# ")?(E=1,v=g.substring(2)):g.startsWith("## ")?(E=2,v=g.substring(3)):g.startsWith("### ")&&(E=3,v=g.substring(4)),E>0&&v.trim()){const W=v.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");d.push({level:E,text:v,id:W})}}),s(d)},[r]);const j=c=>{const d=document.getElementById(c);d&&d.scrollIntoView({behavior:"smooth"})},f=()=>{window.scrollTo({top:0,behavior:"smooth"})},y=()=>{a("/")};return e.jsxs("div",{className:"sticky-top",style:{top:"2rem",padding:"1rem",backgroundColor:i?"#2d3748":"#f8f9fa",border:`1px solid ${i?"#4a5568":"#dee2e6"}`,borderRadius:"0.375rem",maxHeight:"calc(100vh - 4rem)",overflowY:"auto"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h6",{style:{margin:0,fontWeight:"600",fontSize:"0.95rem"},children:"Contents"}),e.jsx("button",{onClick:()=>n(!o),style:{padding:0,backgroundColor:"transparent",border:"none",color:i?"#adb5bd":"#6c757d",cursor:"pointer",textDecoration:"none",fontSize:"0.85rem",fontWeight:"600",transition:"color 0.2s ease"},onMouseEnter:c=>{c.target.style.color=i?"#cbd5e0":"#495057"},onMouseLeave:c=>{c.target.style.color=i?"#adb5bd":"#6c757d"},children:o?"HIDE":"SHOW"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:f,style:{display:"block",width:"100%",padding:"0.5rem",marginBottom:"1rem",backgroundColor:"transparent",border:`1px solid ${i?"#4a5568":"#dee2e6"}`,borderRadius:"0.25rem",color:i?"#a0aec0":"#495057",fontSize:"0.9rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s ease"},onMouseEnter:c=>{c.target.style.backgroundColor=i?"#4a5568":"#e9ecef",c.target.style.color=i?"#cbd5e0":"#212529"},onMouseLeave:c=>{c.target.style.backgroundColor="transparent",c.target.style.color=i?"#a0aec0":"#495057"},children:"â†‘ Back to Top"}),t.length>0?e.jsx("ul",{style:{listStyle:"none",padding:0,margin:"0 0 1rem 0"},children:t.map((c,d)=>e.jsx("li",{style:{marginLeft:`${(c.level-1)*.75}rem`,marginBottom:"0.5rem"},children:e.jsx("button",{onClick:()=>j(c.id),style:{display:"block",width:"100%",padding:"0.4rem 0.5rem",backgroundColor:"transparent",border:"none",color:i?"#a0aec0":"#495057",fontSize:`${.95-(c.level-1)*.05}rem`,cursor:"pointer",textAlign:"left",transition:"color 0.2s ease",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},onMouseEnter:g=>{g.target.style.color=i?"#cbd5e0":"#212529"},onMouseLeave:g=>{g.target.style.color=i?"#a0aec0":"#495057"},children:c.text})},d))}):e.jsx("p",{style:{fontSize:"0.85rem",color:i?"#718096":"#adb5bd",margin:"0 0 1rem 0"},children:"No headings found"}),e.jsx("button",{onClick:y,style:{display:"block",width:"100%",padding:"0.5rem",backgroundColor:"transparent",border:`1px solid ${i?"#4a5568":"#dee2e6"}`,borderRadius:"0.25rem",color:i?"#a0aec0":"#495057",fontSize:"0.9rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s ease"},onMouseEnter:c=>{c.target.style.backgroundColor=i?"#4a5568":"#e9ecef",c.target.style.color=i?"#cbd5e0":"#212529"},onMouseLeave:c=>{c.target.style.backgroundColor="transparent",c.target.style.color=i?"#a0aec0":"#495057"},children:"â† Back to Home"})]})]})}function _e(){const{slug:r}=Ne(),t=be(),[s,o]=h.useState(null),[n,a]=h.useState(!0),[l,i]=h.useState(""),[j,f]=h.useState(!1),[y,c]=h.useState(!1),[d,g]=h.useState(!1),[E,v]=h.useState(""),{theme:W}=h.useContext(Q),{isLoggedIn:q}=h.useContext(te),p=W==="dark";h.useEffect(()=>{r&&(async()=>{try{a(!0);const x=await $e(r);o(x),ne(x)}catch(x){console.error("Error fetching post:",x),i(x.message||"Post not found or failed to load.")}finally{a(!1)}})()},[r]);const ne=u=>{document.title=`${u.title} - Orient Way`;const x=document.querySelector('meta[name="description"]');x&&x.setAttribute("content",u.excerpt||u.title),F(u)},F=u=>{const V=`${window.location.origin}/blog/${u.slug}`,m=(A,k)=>{let S=document.querySelector(`meta[property="${A}"]`);S||(S=document.createElement("meta"),S.setAttribute("property",A),document.head.appendChild(S)),S.setAttribute("content",k)};m("og:title",u.title),m("og:description",u.excerpt||u.title),m("og:url",V),m("og:type","article"),u.coverImage&&m("og:image",u.coverImage),m("article:published_time",u.publishedAt?.toISOString()),m("article:author",u.author||"Orient Way"),u.tags&&u.tags.length>0&&u.tags.forEach(A=>{const k=document.createElement("meta");k.setAttribute("property","article:tag"),k.setAttribute("content",A),document.head.appendChild(k)}),m("twitter:card","summary_large_image"),m("twitter:title",u.title),m("twitter:description",u.excerpt||u.title),u.coverImage&&m("twitter:image",u.coverImage)},ie=async()=>{if(console.log("ðŸ” handleLike called, isLoggedIn:",q),!q){console.log("ðŸš« User not logged in, showing toast"),v("ðŸ˜Š è¯·å…ˆæ³¨å†Œå¹¶ç™»å½•æ‰èƒ½ç‚¹èµžæ–‡ç« ï¼åªæœ‰æ³¨å†Œç”¨æˆ·æ‰èƒ½è¡¨è¾¾å¯¹æ–‡ç« çš„å–œçˆ±ã€‚"),g(!0);return}try{f(!0);const u=await Se(s.id,L.currentUser?.uid);o(x=>({...x,userHasLiked:u.liked,likeCount:u.total})),v(u.message),g(!0)}catch(u){console.error("Error toggling like:",u),v("ç‚¹èµžæ“ä½œå¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•"),g(!0)}finally{f(!1)}},_=u=>{const x=window.location.href,V=s.title;s.excerpt;let m="";switch(u){case"x":m=`https://x.com/intent/tweet?text=${encodeURIComponent(V)}&url=${encodeURIComponent(x)}`;break;case"linkedin":m=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(x)}`;break;case"copy":navigator.clipboard.writeText(x),v("Link copied to clipboard!"),g(!0),c(!1);return;default:return}m&&(window.open(m,"_blank","width=600,height=400"),c(!1))};if(n)return e.jsx(de,{className:"py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading post..."})]})});if(l||!s)return e.jsx(de,{className:"py-5",children:e.jsxs(he,{variant:"danger",className:"text-center",children:[e.jsx("h4",{children:"Post Not Found"}),e.jsx("p",{children:l||"The post you are looking for does not exist."}),e.jsx(I,{variant:"primary",onClick:()=>t("/"),children:"Back to Home"})]})});const ge=u=>u?u.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",ae=u=>u?u.split(`
`).map((m,A)=>{if(m.startsWith("# ")){const k=m.substring(2),S=k.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");return e.jsx("h2",{id:S,style:{fontSize:"1.75rem",fontWeight:"700",marginTop:A>0?"2rem":"0",marginBottom:"1rem",color:p?"#f8f9fa":"#212529"},children:k},A)}if(m.startsWith("## ")){const k=m.substring(3),S=k.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");return e.jsx("h3",{id:S,style:{fontSize:"1.5rem",fontWeight:"600",marginTop:"1.5rem",marginBottom:"0.75rem",color:p?"#f8f9fa":"#212529"},children:k},A)}if(m.startsWith("### ")){const k=m.substring(4),S=k.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");return e.jsx("h4",{id:S,style:{fontSize:"1.25rem",fontWeight:"600",marginTop:"1.25rem",marginBottom:"0.5rem",color:p?"#f8f9fa":"#212529"},children:k},A)}if(m.includes("**")){const k=m.split("**");return e.jsx("p",{style:{marginBottom:"1rem"},children:k.map((S,Y)=>Y%2===1?e.jsx("strong",{children:S},Y):S)},A)}if(m.includes("*")&&!m.includes("**")){const k=m.split("*");return e.jsx("p",{style:{marginBottom:"1rem"},children:k.map((S,Y)=>Y%2===1?e.jsx("em",{children:S},Y):S)},A)}return m.startsWith("- ")?e.jsx("li",{style:{marginBottom:"0.5rem",listStyle:"disc",marginLeft:"1.5rem"},children:m.substring(2)},A):m.trim()===""?e.jsx("br",{},A):e.jsx("p",{style:{marginBottom:"1rem"},children:m},A)}):"",le={fontSize:"1.1rem",lineHeight:"1.7",color:p?"#e9ecef":"#333"},me={fontWeight:"700",lineHeight:"1.2",color:p?"#f8f9fa":"inherit"},ce={fontSize:"1.2rem",fontWeight:"400",lineHeight:"1.4",color:p?"#adb5bd":"#6c757d"},Z={backgroundColor:p?"rgba(255, 255, 255, 0.1)":"rgba(108, 117, 125, 0.1)",color:p?"#adb5bd":"#6c757d",border:"none",padding:"0.25rem 0.5rem",borderRadius:"0.375rem",fontSize:"0.875rem"},b={color:p?"#adb5bd":"#6c757d"},N={borderColor:p?"#495057":"#dee2e6"};return e.jsxs(de,{fluid:!0,style:{maxWidth:"1200px",padding:"1rem"},children:[e.jsxs(Ce,{className:"g-4",children:[e.jsx(fe,{lg:4,xl:3,children:s&&e.jsx(Fe,{content:s.content})}),e.jsx(fe,{lg:8,xl:9,children:e.jsxs("article",{children:[e.jsxs("div",{className:"d-flex flex-wrap align-items-center gap-3 mb-3",children:[s.category&&e.jsx(ue,{bg:"primary",className:"text-uppercase",children:s.category}),e.jsx("small",{style:b,children:ge(s.publishedAt)}),s.readTime&&e.jsxs("small",{style:b,children:[s.readTime," min read"]}),s.views&&e.jsxs("small",{style:b,children:[s.views," views"]})]}),e.jsx("h1",{className:"mb-2",style:me,children:s.title}),s.subtitle&&e.jsx("h2",{className:"mb-4",style:ce,children:s.subtitle}),s.coverImage&&e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:s.coverImage,alt:s.title,className:"img-fluid rounded",style:{width:"100%",height:"auto"}})}),e.jsx("div",{className:"mb-4",style:le,children:e.jsx("div",{children:ae(s.content)})}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{style:b,className:"mb-2",children:"Tags:"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:s.tags.map((u,x)=>e.jsx("span",{style:Z,children:u},x))})]}),e.jsxs("div",{className:"d-flex gap-3 py-3 border-top",style:N,children:[e.jsxs(I,{variant:s.userHasLiked?"primary":"outline-primary",size:"sm",onClick:ie,disabled:j,title:q?"ç‚¹èµžè¿™ç¯‡æ–‡ç« ":"è¯·å…ˆç™»å½•æ‰èƒ½ç‚¹èµž",style:q?{}:{opacity:.7},children:[e.jsx("i",{className:`bi ${s.userHasLiked?"bi-heart-fill":"bi-heart"} me-1`}),j?"Loading...":`Like${s.likeCount>0?` (${s.likeCount})`:""}`]}),e.jsxs(I,{variant:"outline-secondary",size:"sm",onClick:()=>c(!0),children:[e.jsx("i",{className:"bi bi-share me-1"}),"Share"]}),e.jsx(pe,{permission:"blog:write-own",children:s.authorId===L.currentUser?.uid&&e.jsxs(I,{variant:"outline-info",size:"sm",onClick:()=>t(`/editor/${s.id}`),children:[e.jsx("i",{className:"bi bi-pencil me-1"}),"Edit"]})}),e.jsx(pe,{permission:"blog:publish-all",children:e.jsxs(I,{variant:s.status==="published"?"outline-warning":"outline-success",size:"sm",onClick:()=>{s.status==="published"?console.log("Unpublish post"):console.log("Publish post")},children:[e.jsx("i",{className:`bi ${s.status==="published"?"bi-eye-slash":"bi-eye"} me-1`}),s.status==="published"?"Unpublish":"Publish"]})})]})]})})]}),e.jsxs(J,{show:y,onHide:()=>c(!1),centered:!0,children:[e.jsx(J.Header,{closeButton:!0,style:{backgroundColor:p?"#2d3748":"#fff",borderColor:p?"#4a5568":"#dee2e6"},children:e.jsx(J.Title,{style:{color:p?"#f7fafc":"#1a202c"},children:"Share this post"})}),e.jsx(J.Body,{style:{backgroundColor:p?"#2d3748":"#fff",color:p?"#f7fafc":"#1a202c"},children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(I,{variant:"outline-primary",onClick:()=>_("x"),className:"d-flex align-items-center justify-content-start",children:[e.jsx("i",{className:"bi bi-twitter-x me-2"}),"Share on X"]}),e.jsxs(I,{variant:"outline-primary",onClick:()=>_("linkedin"),className:"d-flex align-items-center justify-content-start",children:[e.jsx("i",{className:"bi bi-linkedin me-2"}),"Share on LinkedIn"]}),e.jsxs(I,{variant:"outline-secondary",onClick:()=>_("copy"),className:"d-flex align-items-center justify-content-start",children:[e.jsx("i",{className:"bi bi-clipboard me-2"}),"Copy link"]})]})})]}),e.jsx(Ae,{position:"top-end",className:"p-3",children:e.jsx(ee,{show:d,onClose:()=>g(!1),delay:3e3,autohide:!0,bg:p?"dark":"light",children:e.jsx(ee.Body,{style:{color:p?"#f7fafc":"#1a202c"},children:E})})})]})}const ut=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{Ze as A,Je as B,C as P,Q as T,dt as a,Xe as b,et as c,ot as d,Qe as e,it as f,nt as g,Re as h,rt as i,lt as j,st as k,ct as l,ut as m,at as p,je as u,tt as w};
